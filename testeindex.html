<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <style>
    <?!= include('css/stylemodal') ?>
    <?!= include('css/Frequencia') ?>
</style>
  <style>
   
    /* Importação de fontes */
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap');

    /* Variáveis de cores */
    :root {
      --white: #fff;
      --bg-color: #fef7ef;
      --navbar-color: #4424a7;
      --text-color: #373737;
      --icon-color: #09c0d7;
    }

    /* Reset de estilos */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      outline: none;
      text-decoration: none;
      list-style: none;
      font-family: 'Open Sans', sans-serif;
    }

    /* Estilos gerais */
    body {
      background: var(--bg-color);
      color: var(--text-color);
      padding: 30px;
      font-size: 14px;
    }

    .wrapper {
      background: var(--white);
      height: calc(150vh - 60px);
      border-radius: 15px;
      display: flex;
      box-shadow: 0 1px 1px rgba(0,0,0,0.1);
      overflow: hidden;
      position: relative;
    }

    .main_container {
      width: calc(110% - 225px);
      padding: 30px;
      overflow: auto;
      transition: all 0.3s ease;
      display: none;
    }

    .main_container.active {
      display: block;
    }

    .main_container.p {
      line-height: 22px;
      margin-bottom: 20px;
    }

    .side_bar {
      width: 225px;
      height: 100%;
      background: var(--navbar-color);
      border-radius: 15px;
      padding: 20px;
      padding-right: 0;
      transition: all 0.3s ease;
    }

    .side_bar .side_bar_top {
      padding-bottom: 100px;
      position: relative;
    }

    .side_bar .side_bar_top .logo_wrap {
      text-align: center;
      margin-left: -20px;
    }

    .side_bar .side_bar_top .logo_wrap a {
      color: var(--white);
      font-weight: 700;
      letter-spacing: 2px;
      font-size: 20px;
      padding: 35px 0;
      border-bottom: 1px solid var(--icon-color);
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .side_bar .side_bar_top .logo_wrap a img {
      width: 100px;
      height: 100px;
      margin-right: 10px;
    }

    .side_bar .side_bar_menu {
      position: absolute;
      bottom: 32px;
      right: -22px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--navbar-color);
      border: 4px solid var (--white);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .side_bar .side_bar_menu .menu {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .side_bar .side_bar_menu .i {
      color: var(--white);
      font-size: 18px;
      transform: rotate(180deg);
      transition: all 0.3s ease;
    }

    .side_bar .side_bar_bottom ul li {
      position: relative;
    }

    .side_bar .side_bar_bottom ul li a {
      display: flex;
      align-items: center;
      padding: 15px 25px;
      color: var(--white);
      margin-bottom: 5px;
    }

    .side_bar .side_bar_bottom ul li a .item:hover {
      color: var(--icon-color);
    }

    .side_bar .side_bar_bottom ul li a .icon {
      margin-right: 10px;
      color: var(--icon-color);
      font-size: 16px;
      height: 16px;
    }

    .side_bar .side_bar_bottom ul li.active a {
      background: var(--white);
      color: var(--text-color);
      border-top-left-radius: 25px;
      border-bottom-left-radius: 25px;
    }

    .side_bar .side_bar_bottom ul li.active .top_curve,
    .side_bar .side_bar_bottom ul li.active .bottom_curve {
      position: absolute;
      left: 0;
      width: 100%;
      height: 20px;
      background: var(--white);
    }

    .side_bar .side_bar_bottom ul li.active .top_curve {
      top: -20px;
    }

    .side_bar .side_bar_bottom ul li.active .bottom_curve {
      bottom: -20px;
    }

    .side_bar .side_bar_bottom ul li.active .top_curve:before,
    .side_bar .side_bar_bottom ul li.active .bottom_curve:before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--navbar-color);
    }

    .side_bar .side_bar_bottom ul li.active .top_curve:before {
      border-bottom-right-radius: 25px;
    }

    .side_bar .side_bar_bottom ul li.active .bottom_curve:before {
      border-top-right-radius: 25px;
    }

    .shadow {
      display: none;
    }

    @media screen and (min-width: 1024px) {
      .wrapper.active .side_bar {
        margin-left: -225px;
      }

      .wrapper.active .side_bar .side_bar_menu {
        right: -32px;
      }

      .wrapper.active .side_bar .side_bar_menu .i {
        margin-left: 8px;
        transform: rotate(0);
      }

      .wrapper.active .main_container {
        width: 100%;
        padding-left: 40px;
      }
    }

    @media screen and (max-width: 768px) {
      .wrapper .side_bar {
        position: absolute;
        top: 0;
        left: -225px;
      }

      .wrapper .side_bar .side_bar_menu {
        right: -32px;
      }

      .wrapper .side_bar .side_bar_menu .i {
        margin-left: 8px;
        transform: rotate(0);
      }

      .wrapper .main_container {
        width: 100%;
        padding-left: 40px;
      }

      .wrapper.active .side_bar {
        left: 0;
      }

      .wrapper.active .side_bar .side_bar_menu {
        right: -22px;
      }

      .wrapper.active .side_bar .side_bar_menu .i {
        margin: 0;
        transform: rotate(180deg);
      }

      .wrapper.active .shadow {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,1);
        opacity: 0.25;
      }
    }

    /* Estilos adicionais */
    h2.faq-heading {
      font-family: "Inter", sans-serif;
      text-align: center;
      font-weight: 300;
      font-size: 28px;
      color: #1d3557;
      margin: 8px 0;
      margin-top: 60px;
    }

    .faq-container .question-container {
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .faq-container .question {
      display: flex;
      justify-content: space-between;
      gap: 32px;
      font-size: 18px;
      font-weight: bold;
      padding: 16px 24px;
      cursor: pointer;
    }

    .faq-container .question .question-icon {
      width: 20px;
      height: 20px;
      background: #eee;
      padding: 4px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex;
      transition: all 300ms ease;
    }

    .faq-container .question-container.expanded .question-icon {
      background: #2a9d8f;
      color: #fff;
      transform: rotateZ(180deg);
    }

    .faq-container .answer {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 8px 0;
    }

    .faq-container .answer .answer-icon {
      width: 20px;
      flex-shrink: 0;
      color: blue;
      display: flex;
      margin-top: 5px;
    }

    .faq-container .answer-container {
      padding: 0px 32px;
      background: #edf2f4;
      max-height: 0;
      overflow: hidden;
      transition: all 300ms ease;
    }

    .faq-container .question-container.expanded .answer-container {
      max-height: 500px;
      padding: 8px 32px;
    }

    .icon1 {
      display: block;
      text-align: center;
      margin: 10px auto;
    }

    .icon1 ion-icon {
      font-size: 48px;
      color: #007bff;
    }

    .radius-10 {
      border-radius: 10px !important;
    }

    .border-info {
      border-left: 5px solid #0dcaf0 !important;
    }

    .border-danger {
      border-left: 5px solid #fd3550 !important;
    }

    .border-success {
      border-left: 5px solid #15ca20 !important;
    }

    .border-warning {
      border-left: 5px solid #ffc107 !important;
    }

    .card {
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 0;
      word-wrap: break-word;
      background-color: #fff;
      background-clip: border-box;
      border: 0px solid rgba(0, 0, 0, 0);
      border-radius: .25rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 6px 0 rgb(218 218 253 / 65%), 0 2px 6px 0 rgb(206 206 238 / 54%);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px 0 rgb(218 218 253 / 85%), 0 4px 12px 0 rgb(206 206 238 / 74%);
    }

    .bg-gradient-scooter {
      background: #17ead9;
      background: -webkit-linear-gradient(45deg, #17ead9, #6078ea) !important;
      background: linear-gradient(45deg, #17ead9, #6078ea) !important;
    }

    .widgets-icons-2 {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #ededed;
      font-size: 27px;
      border-radius: 10px;
    }

    .rounded-circle {
      border-radius: 50% !important;
    }

    .text-white {
      color: #fff !important;
    }

    .ms-auto {
      margin-left: auto !important;
    }

    .bg-gradient-bloody {
      background: #f54ea2;
      background: -webkit-linear-gradient(45deg, #f54ea2, #ff7676) !important;
      background: linear-gradient(45deg, #f54ea2, #ff7676) !important;
    }

    .bg-gradient-ohhappiness {
      background: #00b09b;
      background: -webkit-linear-gradient(45deg, #00b09b, #96c93d) !important;
      background: linear-gradient(45deg, #00b09b, #96c93d) !important;
    }

    .bg-gradient-blooker {
      background: #ffdf40;
      background: -webkit-linear-gradient(45deg, #ffdf40, #ff8359) !important;
      background: linear-gradient(45deg, #ffdf40, #ff8359) !important;
    }

    .card-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }

    .card {
      flex: 1;
      margin: 10px;
      min-width: 220px;
      max-width: 300px;
    }

    .card-body {
      padding: 1rem;
    }

    .d-flex {
      display: flex !important;
    }

    .align-items-center {
      align-items: center !important;
    }

    .text-secondary {
      color: #6c757d !important;
    }

    .mb-0 {
      margin-bottom: 0 !important;
    }

    .my-1 {
      margin-top: .25rem !important;
      margin-bottom: .25rem !important;
    }

    .font-13 {
      font-size: 13px !important;
    }

    .modal {
      /* ...existing code... */
      background: rgba(0, 0, 0, 0.5);
    }

    #dataHoje {
    font-size: 0.8rem;  /* Ajuste para o tamanho desejado */
}

  </style>
</head>
<body>
  <!-- Exibir diretamente a área principal -->
  <div id="mainContent" style="display: block;">
    <div class="wrapper">
      <div class="shadow"></div>
      <div class="side_bar">
        <div class="side_bar_top">
          <div class="logo_wrap">
            <a href="#">
               <img src="https://i.ibb.co/PNrHLgf/isntituto-cantos.png" alt="logo">
              <span class="text">Instituto todos os Cantos</span>
            </a>
          </div>
          <div class="side_bar_menu">
            <div class="menu">
              <ion-icon class="i" name="arrow-forward-outline"></ion-icon>
            </div>
          </div>
        </div>
        <div class="side_bar_bottom">
          <ul>
            <li class="active" data-target="dashboard">
              <span class="top_curve"></span>
              <a href="#">
                <span class="icon"><ion-icon name="home-sharp"></ion-icon></span>
                <span class="item">Cadastro</span>
              </a>
              <span class="bottom_curve"></span>
            </li>
            <li data-target="flights">
              <span class="top_curve"></span>
              <a href="#">
                <span class="icon"><ion-icon name="cloud-download-outline"></ion-icon></span>
                <span class="item">Frequência</span>
              </a>
              <span class="bottom_curve"></span>
            </li>
            <li data-target="wallet">
              <span class="top_curve"></span>
              <a href="#">
                <span class="icon"><ion-icon name="wallet-sharp"></ion-icon></span>
                <span class="item">Carteira</span>
              </a>
              <span class="bottom_curve"></span>
            </li>
            <li data-target="reports">
              <span class="top_curve"></span>
              <a href="#">
                <span class="icon"><ion-icon name="help-circle-outline"></ion-icon></span>
                <span class="item">FAQS</span>
              </a>
              <span class="bottom_curve"></span>
            </li>
            <li data-target="details">
              <span class="top_curve"></span>
              <a href="#">
                <span class="icon"><ion-icon name="newspaper-sharp"></ion-icon></span>
                <span class="item">Perfil</span>
              </a>
              <span class="bottom_curve"></span>
            </li>
            <li onclick="logout()">
              <span class="top_curve"></span>
              <a href="#">
                <span class="icon"><ion-icon name="log-out-outline"></ion-icon></span>
                <span class="item">Sair</span>
              </a>
              <span class="bottom_curve"></span>
            </li>
          </ul>
        </div>
      </div>

      <!-- inicio do page Dashboard -->
      <div id="dashboard" class="main_container active">
        <div class="titulo-cadastro-container">
          <h2>Cadastro</h2>
        <p>Visão geral</p>
        </div>
        <div class="container">
          <div class="card-container">
            <div class="card radius-10 border-start border-0 border-3 border-info">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div>
                    <p class="mb-0 text-secondary">Total de Alunos</p>
                    <h4 class="my-1 text-info" id="totalAlunosCadastrado"></h4>
                    <p class="mb-0 font-13" id="totalMês"></p>
                  </div>
                  <div class="widgets-icons-2 rounded-circle bg-gradient-scooter text-white ms-auto">
                    <i class="fa fa-shopping-cart"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="card radius-10 border-start border-0 border-3 border-danger">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div>
                    <p class="mb-0 text-secondary">Total Desistente</p>
                    <h4 class="my-1 text-danger" id="TotalDesistente"></h4>
                    <p class="mb-0 font-13" id="totalMesdesistente"></p>
                  </div>
                  <div class="widgets-icons-2 rounded-circle bg-gradient-bloody text-white ms-auto">
                    <i class="fa fa-dollar"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="card radius-10 border-start border-0 border-3 border-success">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div onclick="abrirNovosRegistros()">
                    <p class="mb-0 text-secondary">Notificação</p>
                    <h4 class="my-1 text-success" id="NotificacaoAguardando"></h4>
                    <p class="mb-0 font-13" id="contador">0 aguardando aprovação</p>
                  </div>
                  <div class="widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto">
                    <i class="fa fa-bar-chart"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="card radius-10 border-start border-0 border-3 border-warning">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div>
                    <p class="mb-0 text-secondary">Hoje</p>
                    <h4 class="my-1 text-warning" id="dataHoje"></h4>
                    <p class="mb-0 font-13" id="percent4"></p>
                  </div>
                  <div class="widgets-icons-2 rounded-circle bg-gradient-blooker text-white ms-auto">
                    <i class="fa fa-users"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
          <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
          <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
          

        <div class="cadastro-container">
        <button id="btnCadastrarNovo" class="btn-cadastrar-novo">Cadastrar Novo</button>
          <!-- Ícone de notificação -->
        </div>

        <!-- Modal para novos registros -->
        <div id="modalNovosRegistros" class="modal">
          <div class="modal-content">
            <span class="close-button" onclick="fecharModalNovosRegistros()">&times;</span>
            <h2>Novos Registros</h2>
            <!-- Botão de fechar modal -->
            <button type="button" class="btn-fechar" onclick="fecharModalNovosRegistros()">Fechar</button>
            <!-- Tabela para exibir os novos registros -->
            <table id="tabelaNovosRegistros" class="display" style="width:100%">
              <thead>
                <tr>
                  <th>Nome Completo</th>
                  <th>Celular</th>
                  <th>Data Nascimento</th>
                  <th>Data Cadastro</th>
                  <th>Tipo Coral</th>
                </tr>
              </thead>
              <tbody>
                <!-- Dados serão inseridos dinamicamente -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Modal para detalhes do registro -->
        <div id="modalDetalhesRegistro" class="modal">
          <div class="modal-content">
            <span class="close-button" onclick="fecharModalDetalhesRegistro()">&times;</span>
            <h2>Detalhes do Registro</h2>
            <!-- Formulário com todos os campos -->
            <form id="formDetalhesRegistro">
              <div class="form-grid">
                <!-- Linha 1: Nome Completo -->
                <div class="form-row">
                  <label for="detalhesNomeCompleto">Nome Completo:</label>
                  <input type="text" id="detalhesNomeCompleto" name="detalhesNomeCompleto">
                </div>
                <!-- Linha 2: Endereço -->
                <div class="form-row">
                  <label for="detalhesEndereco">Endereço:</label>
                  <input type="text" id="detalhesEndereco" name="detalhesEndereco">
                </div>
                <!-- Linha 3: RG -->
                <div class="form-row">
                  <label for="detalhesRG">RG:</label>
                  <input type="text" id="detalhesRG" name="detalhesRG">
                </div>
                <!-- Linha 4: CPF -->
                <div class="form-row">
                  <label for="detalhesCPF">CPF:</label>
                  <input type="text" id="detalhesCPF" name="detalhesCPF">
                </div>
                <!-- Linha 5: Celular -->
                <div class="form-row">
                  <label for="detalhesCelular">Celular:</label>
                  <input type="text" id="detalhesCelular" name="detalhesCelular">
                </div>
                <!-- Linha 6: Profissão -->
                <div class="form-row">
                  <label for="detalhesProfissao">Profissão:</label>
                  <input type="text" id="detalhesProfissao" name="detalhesProfissao">
                </div>
                <!-- Linha 7: Email -->
                <div class="form-row">
                  <label for="detalhesEmail">Email:</label>
                  <input type="email" id="detalhesEmail" name="detalhesEmail">
                </div>
                <!-- Linha 8: Data de Nascimento -->
                <div class="form-row">
                  <label for="detalhesDataNascimento">Data de Nascimento:</label>
                  <input type="date" id="detalhesDataNascimento" name="detalhesDataNascimento">
                </div>
                <!-- Linha 9: Escolaridade -->
                <div class="form-row">
                  <label for="detalhesEscolaridade">Escolaridade:</label>
                  <select id="detalhesEscolaridade" name="detalhesEscolaridade">
                    <option value="Educação infantil">Educação infantil</option>
                    <option value="Fundamental">Fundamental</option>
                    <option value="Médio">Médio</option>
                    <option value="Superior (Graduação)">Superior (Graduação)</option>
                    <option value="Pós-graduação">Pós-graduação</option>
                    <option value="Mestrado">Mestrado</option>
                    <option value="Doutorado">Doutorado</option>
                    <option value="Escola">Escola</option>
                  </select>
                </div>
                <!-- Linha 10: Ligação com Música -->
                <div class="form-row">
                  <label for="detalhesLigacaoComMusica">Ligação com Música:</label>
                  <input type="text" id="detalhesLigacaoComMusica" name="detalhesLigacaoComMusica">
                </div>
                <!-- Linha 11: Classificação Vocal -->
                <div class="form-row">
                  <label for="detalhesClassificacaoVocal">Classificação Vocal:</label>
                  <select id="detalhesClassificacaoVocal" name="detalhesClassificacaoVocal">
                    <option value="">Selecione</option>
                    <option value="Mezzo-soprano">Mezzo-soprano</option>
                    <option value="Barítono">Barítono</option>
                    <option value="Soprano">Soprano</option>
                    <option value="Contralto">Contralto</option>
                    <option value="Tenor">Tenor</option>
                  </select>
                </div>
                <!-- Linha 12: Como Soube -->
                <div class="form-row">
                  <label for="detalhesComoSoube">Como Soube:</label>
                  <input type="text" id="detalhesComoSoube" name="detalhesComoSoube">
                </div>
                <!-- Linha 13: Tipo de Coral -->
                <div class="form-row">
                  <label for="detalhesTipoCoral">Tipo de Coral:</label>
                  <select id="detalhesTipoCoral" name="detalhesTipoCoral">
                    <option value="" disabled selected>Escolha uma opção</option>
                    <option value="CoralUnimed">Coral Unimed</option>
                    <option value="AlgazarraCoral">Algazarra Coral</option>
                  </select>
                </div>
                <!-- Linha 14: Status -->
                <div class="form-row">
                  <label for="detalhesStatus">Status:</label>
                  <select id="detalhesStatus" name="detalhesStatus">
                    <option value="Ativo">Ativo</option>
                    <option value="Desistente">Desistente</option>
                  </select>
                </div>
                <!-- Linha 15: Gênero -->
                <div class="form-row">
                  <label for="detalhesGenero">Gênero:</label>
                  <select id="detalhesGenero" name="detalhesGenero">
                    <option value="Feminino">Feminino</option>
                    <option value="Masculino">Masculino</option>
                  </select>
                </div>
                <!-- Linha 16: Data de Desistência -->
                <div class="form-row">
                  <label for="detalhesDataDesistencia">Data de Desistência:</label>
                  <input type="date" id="detalhesDataDesistencia" name="detalhesDataDesistencia">
                </div>
                <!-- Linha 17: Data de Cadastro -->
                <div class="form-row">
                  <label for="detalhesDataCadastro">Data de Cadastro:</label>
                  <input type="date" id="detalhesDataCadastro" name="detalhesDataCadastro">
                </div>
                <!-- Linha 18: Recebe Benefício -->
                <div class="form-row">
                  <label for="detalhesRecebeBeneficio">Recebe Benefício:</label>
                  <select id="detalhesRecebeBeneficio" name="detalhesRecebeBeneficio">
                    <option value="">Selecione</option>
                    <option value="bolsista">Bolsista</option>
                    <option value="cestaBasicaVerde">Cesta Básica + Cesta Verde</option>
                  </select>
                </div>
                <!-- Linha 19: Termo Uso de Imagem -->
                <div class="form-row">
                  <label for="detalhesUsoImagem">Termo Uso de Imagem:</label>
                  <select id="detalhesUsoImagem" name="detalhesUsoImagem">
                    <option value="Sim">Sim</option>
                    <option value="Não">Não</option>
                  </select>
                </div>
                <!-- Linha 20: Tipo de Responsável -->
                <div class="form-row">
                  <label for="detalhesTipoResponsavel">Tipo de Responsável:</label>
                  <select id="detalhesTipoResponsavel" name="detalhesTipoResponsavel">
                    <option value="">Selecione um responsável</option>
                    <option value="avo1">Avô</option>
                    <option value="avo2">Avó</option>
                    <option value="tio">Tio(a)</option>
                    <option value="irmao">Irmão(ã)</option>
                    <option value="outro">Outro Responsável</option>
                  </select>
                </div>
                <!-- Linha 21: Nome do Responsável -->
                <div class="form-row" id="detalhesResponsavelContainer" style="display: none;">
                  <label for="detalhesResponsavel">Nome do Responsável:</label>
                  <input type="text" id="detalhesResponsavel" name="detalhesResponsavel">
                </div>
                <!-- Linha 22: Nome do Pai -->
                <div class="form-row">
                  <label for="detalhesNomePai">Nome do Pai:</label>
                  <input type="text" id="detalhesNomePai" name="detalhesNomePai">
                </div>
                <!-- Linha 23: Nome da Mãe -->
                <div class="form-row">
                  <label for="detalhesNomeMae">Nome da Mãe:</label>
                  <input type="text" id="detalhesNomeMae" name="detalhesNomeMae">
                </div>
                <!-- Linha 24: Bairro -->
                <div class="form-row">
                  <label for="detalhesBairro">Bairro:</label>
                  <input type="text" id="detalhesBairro" name="detalhesBairro">
                </div>
                <!-- Linha 25: Cidade -->
                <div class="form-row">
                  <label for="detalhesCidade">Cidade:</label>
                  <input type="text" id="detalhesCidade" name="detalhesCidade">
                </div>
                <!-- Linha 26: UF -->
                <div class="form-row">
                  <label for="detalhesUF">Estado (UF):</label>
                  <input type="text" id="detalhesUF" name="detalhesUF">
                </div>
                <!-- Linha 27: CEP -->
                <div class="form-row">
                  <label for="detalhesCEP">CEP:</label>
                  <input type="text" id="detalhesCEP" name="detalhesCEP">
                  <a href="https://buscacepinter.correios.com.br/app/endereco/index.php" target="_blank" class="consulta-cep-link">Consulta CEP</a>
                </div>
              </div>
              <!-- Botões -->
              <div class="form-actions">
                <button type="button" class="btn-transferir" onclick="transferirRegistro()">Transferir</button>
                <button type="button" class="btn-fechar" onclick="fecharModalDetalhesRegistro()">Fechar</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Tabela para exibir os dados -->
        <table id="tabelaAlunos" class="display" style="width:100%">
          <thead>
            <tr>
              <th>Nome Completo</th>
              <th>Endereço</th>
              <th>CPF</th>
              <th>Celular</th>
              <th>Email</th>
              <th>Data Nascimento</th>
              <th>Data Cadastro</th>
             <th>Data Desistência</th>
              <!-- Adicionar demais colunas conforme necessário -->
            </tr>
          </thead>
          <tbody>
            <!-- Dados serão inseridos dinamicamente -->
          </tbody>
        </table>

        <!-- Modal de cadastro -->
        <div id="modalCadastro" class="modal">
          <div class="modal-content">
            <span class="close-button" onclick="fecharModal()">&times;</span>
            <h2>Cadastro Novo</h2>
            <!-- Formulário de cadastro -->
            <form id="formCadastro">
              <div class="form-grid">
                <!-- Linha 2 -->
                <div class="form-row">
                  <label for="nomeCompleto">Nome Completo:</label>
                  <input type="text" id="nomeCompleto" name="nomeCompleto" required>
                </div>
                <!-- Linha 3 -->
                <!-- Linha X: CEP -->
                <div class="form-row">
                  <label for="cep">CEP:</label>
                  <input type="text" id="cep" name="cep">
                  <a href="https://buscacepinter.correios.com.br/app/endereco/index.php" target="_blank" class="consulta-cep-link">Consulta CEP</a>
                </div>
                <!-- Linha X+1: Endereço -->
                <div class="form-row">
                  <label for="endereco">Endereço:</label>
                  <input type="text" id="endereco" name="endereco" required>
                </div>
                <!-- Linha X+2: Bairro -->
                <div class="form-row">
                  <label for="bairro">Bairro:</label>
                  <input type="text" id="bairro" name="bairro">
                </div>
                <!-- Linha X+3: Cidade -->
                <div class="form-row">
                  <label for="cidade">Cidade:</label>
                  <input type="text" id="cidade" name="cidade">
                </div>
                <!-- Linha X+4: Estado -->
                <div class="form-row">
                  <label for="estado">Estado:</label>
                  <input type="text" id="estado" name="estado">
                </div>
                <!-- Linha 4 -->
                <div class="form-row">
                  <label for="rg">RG:</label>
                  <input type="text" id="rg" name="rg">
                </div>
                <!-- Linha 5 -->
                <div class="form-row">
                  <label for="cpf">CPF:</label>
                  <input type="text" id="cpf" name="cpf">
                </div>
                <!-- Linha 6 -->
                <div class="form-row">
                  <label for="celular">Celular:</label>
                  <input type="text" id="celular" name="celular">
                </div>
                <!-- Linha 7 -->
                <div class="form-row">
                  <label for="profissao">Profissão:</label>
                  <input type="text" id="profissao" name="profissao">
                </div>
                <!-- Linha 8 -->
                <div class="form-row">
                  <label for="email">Email:</label>
                  <input type="email" id="email" name="email">
                </div>
                <!-- Linha 9 -->
                <div class="form-row">
                  <label for="dataNascimento">Data de Nascimento:</label>
                  <input type="date" id="dataNascimento" name="dataNascimento">
                </div>
                <!-- Linha 10 -->
                <div class="form-row">
                  <label for="escolaridade">Escolaridade:</label>
                  <select id="escolaridade" name="escolaridade">
                    <option value="Educação infantil">Educação infantil</option>
                    <option value="Fundamental">Fundamental</option>
                    <option value="Médio">Médio</option>
                    <option value="Superior (Graduação)">Superior (Graduação)</option>
                    <option value="Pós-graduação">Pós-graduação</option>
                    <option value="Mestrado">Mestrado</option>
                    <option value="Doutorado">Doutorado</option>
                    <option value="Escola">Escola</option>
                  </select>
                </div>
                <!-- Linha 11 -->
                <div class="form-row">
                  <label for="ligacaoComMusica">Ligação com Música:</label>
                  <input type="text" id="ligacaoComMusica" name="ligacaoComMusica">
                </div>
                <!-- Linha 12 -->
                <div class="form-row">
                  <label for="classificacaoVocal">Tipo de Vocação:</label>
                  <select id="classificacaoVocal" name="classificacaoVocal">
                    <option value="">Tipo de Vocação</option>
                    <option value="Mezzo-soprano">Mezzo-soprano</option>
                    <option value="Barítono">Barítono </option>
                    <option value="Soprano">Soprano</option>
                    <option value="Contralto">Contralto</option>
                    <option value="Tenor">Tenor</option>
                  </select>
                </div>
                <!-- Linha 13 -->
                <div class="form-row">
                  <label for="comoSoube">Como Soube:</label>
                  <input type="text" id="comoSoube" name="comoSoube">
                </div>
                <!-- Linha 14 -->
                <div class="form-row">
                  <label for="tipoCoral">Tipo de Coral:</label>
                  <select id="tipoCoral" name="tipoCoral">
                    <option value="" disabled selected>Escolha uma opção</option>
                    <option value="CoralUnimed">Coral Unimed</option>
                    <option value="AlgazarraCoral">Algazarra Coral</option>
                  </select>
                </div>
                <!-- Linha 15 -->
                <div class="form-row">
                  <label for="status">Status:</label>
                  <select id="status" name="status">
                    <option value="Ativo">Ativo</option>
                    <option value="Desistente">Desistente</option>
                  </select>
                </div>
                <!-- Linha 16 -->
                <div class="form-row">
                  <label for="genero">Gênero:</label>
                  <select id="genero" name="genero">
                    <option value="Feminino">Feminino</option>
                    <option value="Masculino">Masculino</option>
                  </select>
                </div>
                <!-- Linha 17 -->
                <div class="form-row">
                  <label for="dataDesistencia">Data de Desistência:</label>
                  <input type="date" id="dataDesistencia" name="dataDesistencia">
                </div>
                <!-- Linha 18 -->
                <div class="form-row">
                  <label for="dataCadastro">Data de Cadastro:</label>
                  <input type="date" id="dataCadastro" name="dataCadastro" required>
                </div>
                <!-- Linha 19 -->
                <div class="form-row">
                  <label for="recebeBeneficio">Recebe Benefício:</label>
                  <select id="recebeBeneficio" name="recebeBeneficio">
                    <option value="">Recebe Benefício</option>
                    <option value="bolsista">Bolsista</option>
                    <option value="cestaBasicaVerde">Cesta Básica + Cesta Verde</option>
                  </select>
                </div>
                <!-- Linha 20 -->
                <div class="form-row"></div>
                <!-- Linha 21 -->
                <div class="form-row">
                  <label for="usoImagem">Termo uso de imagem:</label>
                  <select id="usoImagem" name="usoImagem">
                    <option value="Sim">Sim</option>
                    <option value="Não">Não</option>
                  </select>
                </div>
                <!-- Linha 22: Adicionar nova caixa de seleção para tipoResponsavel -->
                <div class="form-row">
                  <label for="tipoResponsavel">Tipo de Responsável:</label>
                  <select id="tipoResponsavel" name="tipoResponsavel">
                    <option value="">Selecione um responsável</option>
                    <option value="avo1">Avô</option>
                    <option value="avo2">Avó</option>
                    <option value="tio">Tio(a)</option>
                    <option value="irmao">Irmão(ã)</option>
                    <option value="outro">Outro Responsável</option>
                  </select>
                </div>
                <!-- Linha 23: Modificar o campo responsavel para estar oculto por padrão -->
                <div class="form-row" id="responsavelcontainer" style="display: none;">
                  <label for="responsavel">Nome do Responsável:</label>
                  <input type="text" id="responsavel" name="responsavel">
                </div>
                <!-- Linha 24 -->
                <div class="form-row">
                  <label for="nomePai">Nome do Pai:</label>
                  <input type="text" id="nomePai" name="nomePai">
                </div>
                <!-- Linha 25 -->
                <div class="form-row">
                  <label for="nomeMae">Nome da Mãe:</label>
                  <input type="text" id="nomeMae" name="nomeMae">
                </div>
              </div>
              <!-- Botões -->
              <div class="form-actions">
                <button type="submit" class="btn-salvar">Salvar</button>
                <button type="button" class="btn-fechar" onclick="fecharModal()">Fechar</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Modal de Edição -->
        <div id="modalEditarCadastro" class="modal">
          <div class="modal-content">
            <span class="close-button" onclick="fecharModal()">&times;</span>
            <h2>Editar Cadastro</h2>
            <!-- Formulário de edição -->
            <form id="formEditarCadastro">
              <div class="form-grid">
                <!-- Linha 1: Nome Completo -->
                <div class="form-row">
                  <label for="editarNomeCompleto">Nome Completo:</label>
                  <input type="text" id="editarNomeCompleto" name="editarNomeCompleto">
                </div>
                <!-- Linha X: CEP -->
                <div class="form-row">
                  <label for="editarCEP">CEP:</label>
                  <input type="text" id="editarCEP" name="editarCEP">
                </div>
                <!-- Linha X+1: Endereço -->
                <div class="form-row">
                  <label for="editarEndereco">Endereço:</label>
                  <input type="text" id="editarEndereco" name="editarEndereco">
                </div>
                <!-- Linha X+2: Bairro -->
                <div class="form-row">
                  <label for="editarBairro">Bairro:</label>
                  <input type="text" id="editarBairro" name="editarBairro">
                </div>
                <!-- Linha X+3: Cidade -->
                <div class="form-row">
                  <label for="editarCidade">Cidade:</label>
                  <input type="text" id="editarCidade" name="editarCidade">
                </div>
                <!-- Linha X+4: Estado -->
                <div class="form-row">
                  <label for="editarEstado">Estado:</label>
                  <input type="text" id="editarEstado" name="editarEstado">
                </div>
                <!-- Linha 3: RG -->
                <div class="form-row">
                  <label for="editarRG">RG:</label>
                  <input type="text" id="editarRG" name="editarRG">
                </div>
                <!-- Linha 4: CPF -->
                <div class="form-row">
                  <label for="editarCPF">CPF:</label>
                  <input type="text" id="editarCPF" name="editarCPF">
                </div>
                <!-- Linha 5: Celular -->
                <div class="form-row">
                  <label for="editarCelular">Celular:</label>
                  <input type="text" id="editarCelular" name="editarCelular">
                </div>
                <!-- Linha 6: Profissão -->
                <div class="form-row">
                  <label for="editarProfissao">Profissão:</label>
                  <input type="text" id="editarProfissao" name="editarProfissao">
                </div>
                <!-- Linha 7: Email -->
                <div class="form-row">
                  <label for="editarEmail">Email:</label>
                  <input type="email" id="editarEmail" name="editarEmail">
                </div>
                <!-- Linha 8: Data de Nascimento -->
                <div class="form-row">
                  <label for="editarDataNascimento">Data de Nascimento:</label>
                  <input type="date" id="editarDataNascimento" name="editarDataNascimento">
                </div>
                <!-- Linha 9: Escolaridade -->
                <div class="form-row">
                  <label for="editarEscolaridade">Escolaridade:</label>
                  <select id="editarEscolaridade" name="editarEscolaridade">
                    <option value="Educação infantil">Educação infantil</option>
                    <option value="Fundamental">Fundamental</option>
                    <option value="Médio">Médio</option>
                    <option value="Superior (Graduação)">Superior (Graduação)</option>
                    <option value="Pós-graduação">Pós-graduação</option>
                    <option value="Mestrado">Mestrado</option>
                    <option value="Doutorado">Doutorado</option>
                    <option value="Escola">Escola</option>
                  </select>
                </div>
                <!-- Linha 10: Ligação com Música -->
                <div class="form-row">
                  <label for="editarLigacaoComMusica">Ligação com Música:</label>
                  <input type="text" id="editarLigacaoComMusica" name="editarLigacaoComMusica">
                </div>
                <!-- Linha 11: Classificação Vocal -->
                <div class="form-row">
                  <label for="editarClassificacaoVocal">Tipo de Vocação:</label>
                  <select id="editarClassificacaoVocal" name="editarClassificacaoVocal">
                    <option value="">Tipo de Vocação</option>
                    <option value="Mezzo-soprano">Mezzo-soprano</option>
                    <option value="Barítono">Barítono </option>
                    <option value="Soprano">Soprano</option>
                    <option value="Contralto">Contralto</option>
                    <option value="Tenor">Tenor</option>
                  </select>
                </div>
                <!-- Linha 12: Como Soube -->
                <div class="form-row">
                  <label for="editarComoSoube">Como Soube:</label>
                  <input type="text" id="editarComoSoube" name="editarComoSoube">
                </div>
                <!-- Linha 13: Tipo de Coral -->
                <div class="form-row">
                  <label for="editarTipoCoral">Tipo de Coral:</label>
                  <select id="editarTipoCoral" name="editarTipoCoral">
                    <option value="" disabled selected>Escolha uma opção</option>
                    <option value="CoralUnimed">Coral Unimed</option>
                    <option value="AlgazarraCoral">Algazarra Coral</option>
                  </select>
                </div>
                <!-- Linha 14: Status -->
                <div class="form-row">
                  <label for="editarStatus">Status:</label>
                  <select id="editarStatus" name="editarStatus">
                    <option value="Ativo">Ativo</option>
                    <option value="Desistente">Desistente</option>
                  </select>
                </div>
                <!-- Linha 15: Gênero -->
                <div class="form-row">
                  <label for="editarGenero">Gênero:</label>
                  <select id="editarGenero" name="editarGenero">
                    <option value="Feminino">Feminino</option>
                    <option value="Masculino">Masculino</option>
                  </select>
                </div>
                <!-- Linha 16: Data de Desistência -->
                <div class="form-row">
                  <label for="editarDataDesistencia">Data de Desistência:</label>
                  <input type="date" id="editarDataDesistencia" name="editarDataDesistencia">
                </div>
                <!-- Linha 17: Data de Cadastro -->
                <div class="form-row">
                  <label for="editarDataCadastro">Data de Cadastro:</label>
                  <input type="date" id="editarDataCadastro" name="editarDataCadastro">
                </div>
                <!-- Linha 18: Recebe Benefício -->
                <div class="form-row">
                  <label for="editarRecebeBeneficio">Recebe Benefício:</label>
                  <select id="editarRecebeBeneficio" name="editarRecebeBeneficio">
                    <option value="">Recebe Benefício</option>
                    <option value="bolsista">Bolsista</option>
                    <option value="cestaBasicaVerde">Cesta Básica + Cesta Verde</option>
                  </select>
                </div>
                <!-- Linha 19 -->
                <div class="form-row">
                  <label for="editarusoImagem">Termo uso de imagem:</label>
                  <select id="editarusoImagem" name="editarusoImagem">
                    <option value="Sim">Sim</option>
                    <option value="Não">Não</option>
                  </select>
                </div>
                <!-- Linha 20 -->
                <!-- campo vazio -->
                <!-- Linha 21 -->
                <div class="form-row">
                  <label for="tipoResponsavelEditar">Tipo de Responsável:</label>
                  <select id="tipoResponsavelEditar" name="tipoResponsavelEditar">
                    <option value="">Selecione um responsável</option>
                    <option value="avo1">Avô</option>
                    <option value="avo2">Avó</option>
                    <option value="tio">Tio(a)</option>
                    <option value="irmao">Irmão(ã)</option>
                    <option value="outro">Outro Responsável</option>
                  </select>
                </div>
                <!-- Linha 22 -->
                <div class="form-row" id="editarResponsavelContainer" style="display: none;">
                  <label for="editarresponsavel">Nome do Responsável:</label>
                  <input type="text" id="editarresponsavel" name="editarresponsavel">
                </div>
                <!-- Linha 23 -->
                <div class="form-row">
                  <label for="editarNomePai">Nome do Pai:</label>
                  <input type="text" id="editarNomePai" name="editarNomePai">
                </div>
                <!-- Linha 24 -->
                <div class="form-row">
                  <label for="editarNomeMae">Nome da Mãe:</label>
                  <input type="text" id="editarNomeMae" name="editarNomeMae">
                </div>
                <!-- Botões -->
                <div class="form-actions">
                  <button type="submit" class="btn-salvar">Salvar</button>
                  <button type="button" class="btn-fechar" onclick="fecharModal()">Fechar</button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <script>
          // Inclua este código após a inclusão do jQuery e outras bibliotecas
          $(document).ready(function() {
            var linhaIndiceGlobal;
            var dadosCompleto = []; // Variável global para armazenar os dados do servidor
            var table;

            // Função para carregar os dados quando a página for ativada
            function carregarDadosCadastro() {
              // Exibir spinner de carregamento
              $('#tabelaAlunos tbody').html('<tr><td colspan="9">Carregando...</td></tr>');

              // Remover o evento dblclick antes de recriar a tabela para evitar duplicação
              $('#tabelaAlunos').off('dblclick', 'tbody tr');

              if ($.fn.dataTable.isDataTable('#tabelaAlunos')) {
                $('#tabelaAlunos').DataTable().clear().destroy();
              }

              // Chamar a função do servidor para obter os dados
              google.script.run.withSuccessHandler(function(response) {
                dadosCompleto = response.data; // Armazenar os dados quando recebidos

                // Processar os dados recebidos
                if (response && response.data) {
                  // Inicializar a tabela com os dados
                  var table = $('#tabelaAlunos').DataTable({
                    data: response.data,
                    columns: [
                      { data: 'NomeCompleto' },
                      { data: 'Endereco' },
                      { data: 'CPF' },
                      { data: 'Celular' },
                      { data: 'Email' },
                      { data: 'dataNascimento' },
                      { data: 'dataCadastro' },
                      { data: 'dataDesistencia' },
                    ],
                    pageLength: 20,
                    searching: true,
                    paging: true,
                    destroy: true, // Permite reinicializar o DataTable
                    responsive: true,
                    ordering: true,
                    info: true,
                    language: {
                      "sEmptyTable": "Nenhum registro encontrado",
                      "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
                      "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
                      "sInfoFiltered": "(Filtrados de _MAX_ registros)",
                      "sLengthMenu": "_MENU_ resultados por página",
                      "sLoadingRecords": "Carregando...",
                      "sProcessing": "Processando...",
                      "sZeroRecords": "Nenhum registro encontrado",
                      "sSearch": "Pesquisar",
                      "oPaginate": {
                        "sNext": "Próximo",
                        "sPrevious": "Anterior",
                        "sFirst": "Primeiro",
                        "sLast": "Último"
                      },
                      "oAria": {
                        "sSortAscending": ": Ordenar colunas de forma ascendente",
                        "sSortDescending": ": Ordenar colunas de forma descendente"
                      }
                    } 
                    
                    });
               
                                 // Adicionar novamente o evento de duplo clique após a recriação da tabela
                  $('#tabelaAlunos').on('dblclick', 'tbody tr', function() {
                    var data = table.row(this).data(); // Obter os dados da linha clicada
                    var linhaIndice = table.row(this).index() + 2; // Captura o índice da linha na tabela (linha 1 é o cabeçalho)
                    var nome = data.NomeCompleto; // Coluna do nome
                    var cpf = data.CPF; // Coluna do CPF

                    // Chamar a função para abrir o modal de edição
                    editarCadastro(nome, cpf, linhaIndice); // Função para abrir o modal de edição
                  });
                } else {
                  $('#tabelaAlunos tbody').html('<tr><td colspan="9">Nenhum dado disponível.</td></tr>');
                }
                atualizarContagemAlunos(response.data);
              }).withFailureHandler(function(error) {
                console.error('Erro ao obter dados: ', error);
                $('#tabelaAlunos tbody').html('<tr><td colspan="9">Erro ao carregar os dados.</td></tr>');
              }).obterDadosCadastro(); // Chama a função sem parâmetros
            }
            $('#tabelaAlunos').DataTable({
                  autoWidth: false, // Para respeitar as larguras definidas
                  columns: [
                    { title: 'Nome Completo', width: '15%' },
                    { title: 'Endereço', width: '25%' },
                    { title: 'CPF', width: '10%' },
                    { title: 'Celular', width: '10%' },
                    { title: 'Email', width: '15%' },
                    { title: 'Data Nascimento', width: '10%' },
                    { title: 'Data Cadastro', width: '10%' },
                    { title: 'Data Desistência', width: '5%' }
                  ]
                });



            // Função para aplicar as máscaras nos campos CPF e Celular
            function aplicarMascaras() {
              $('#cpf').inputmask('999.999.999-99');
              $('#celular').inputmask('(99) 99999-9999');
              $('#editarCPF').inputmask('999.999.999-99');
              $('#editarCelular').inputmask('(99) 99999-9999');
            }

            // Função para carregar a data de hoje no campo dataCadastro
            function preencherDataHoje() {
              var hoje = new Date().toISOString().split('T')[0]; // Formato YYYY-MM-DD
              $('#dataCadastro').val(hoje); // Preenche o campo dataCadastro com a data de hoje
            }

            // Abrir o modal ao clicar no botão
            $('#btnCadastrarNovo').on('click', function() {
              $('#modalCadastro').show(); // Abre o modal
              aplicarMascaras(); // Aplica as máscaras assim que o modal é aberto
              preencherDataHoje(); // Insere a data atual no campo "dataCadastro"
            });

            // Eventos para fechar o modal
            $('.close-button').on('click', fecharModal); // Fecha o modal ao clicar no botão de fechar
            $('.btn-fechar').on('click', fecharModal);   // Fecha o modal ao clicar no botão "Fechar"

            // Fechar o modal ao clicar fora dele
            $(window).on('click', function(event) {
              if ($(event.target).is('#modalCadastro')) {
                fecharModal(); // Fecha o modal se clicar fora dele
              }
            });

            // Lidar com o envio do formulário
            $('#formCadastro').on('submit', function(event) {
              event.preventDefault(); // Impede o comportamento padrão de envio do formulário

              // Obter os dados do formulário
              var dados = {
                nomeCompleto: $('#nomeCompleto').val(),
                endereco: $('#endereco').val(),
                bairro: $('#bairro').val(),
                cidade: $('#cidade').val(),
                estado: $('#estado').val(),
                cep: $('#cep').val(),
                rg: $('#rg').val(),
                cpf: $('#cpf').val(),
                celular: $('#celular').val(),
                profissao: $('#profissao').val(),
                email: $('#email').val(),
                dataNascimento: $('#dataNascimento').val(),
                escolaridade: $('#escolaridade').val(),
                ligacaoComMusica: $('#ligacaoComMusica').val(),
                classificacaoVocal: $('#classificacaoVocal').val(),
                comoSoube: $('#comoSoube').val(),
                tipoCoral: $('#tipoCoral').val(),
                status: $('#status').val(),
                genero: $('#genero').val(),
                dataDesistencia: $('#dataDesistencia').val(),
                dataCadastro: $('#dataCadastro').val(),
                recebeBeneficio: $('#recebeBeneficio').val(),
                usoImagem: $('#usoImagem').val(),
                tipoResponsavel: $('#tipoResponsavel').val(),
                responsavel: $('#responsavel').val(),
                nomePai: $('#nomePai').val(),
                nomeMae: $('#nomeMae').val()
              };

              // Chamar a função do servidor para salvar os dados
              google.script.run.withSuccessHandler(function(response) {
                // Exibir feedback visual
                $('#mensagemSucesso').show();
                // Limpar o formulário após o sucesso
                $('#formCadastro')[0].reset();
                // Fechar o modal após alguns segundos
                setTimeout(function() {
                  fecharModal(); // Fechar o modal após o sucesso
                }, 1000);
                carregarDadosCadastro(); // Atualizar a tabela de cadastro
              }).withFailureHandler(function(error) {
                console.error('Erro ao salvar os dados:', error);
                alert('Ocorreu um erro ao salvar os dados. Por favor, tente novamente.');
              }).salvarCadastroNovo(dados); // Enviar os dados para o servidor
            });

            // Função para abrir o modal de edição e passar o índice da linha junto
            function editarCadastro(nome, cpf, linhaIndice) {
              linhaIndiceGlobal = linhaIndice; // Armazenar o índice da linha

              // Função para buscar os dados completos pelo CPF ou nome
              var dadosEncontrados = buscarDadosPorCpfOuNome(cpf, nome);

              if (dadosEncontrados) {
                // Abrir o modal de edição
                $('#modalEditarCadastro').show();
                aplicarMascaras();

                // Preencher os campos no modal com os dados capturados
                $('#editarNomeCompleto').val(dadosEncontrados.NomeCompleto);
                $('#editarEndereco').val(dadosEncontrados.Endereco);
                $('#editarBairro').val(dadosEncontrados.bairro);
                $('#editarCidade').val(dadosEncontrados.cidade);
                $('#editarEstado').val(dadosEncontrados.estado);
                $('#editarCEP').val(dadosEncontrados.cep);
                $('#editarRG').val(dadosEncontrados.RG);
                $('#editarCPF').val(dadosEncontrados.CPF);
                $('#editarCelular').val(dadosEncontrados.Celular);
                $('#editarProfissao').val(dadosEncontrados.Profissao);
                $('#editarEmail').val(dadosEncontrados.Email);

                // Converter datas para o formato correto yyyy-mm-dd
                $('#editarDataNascimento').val(formatarData(dadosEncontrados.dataNascimento));
                $('#editarDataCadastro').val(formatarData(dadosEncontrados.dataCadastro));
                $('#editarDataDesistencia').val(formatarData(dadosEncontrados.dataDesistencia));

                // Preencher o status automaticamente com base na data de desistência
                if (dadosEncontrados.dataDesistencia) {
                  $('#editarStatus').val('Desistente');
                } else {
                  $('#editarStatus').val('Ativo');
                }

                // Preencher os campos dropdown
                $('#editarEscolaridade').val(dadosEncontrados.Escolaridade);
                $('#editarLigacaoComMusica').val(dadosEncontrados.ligacaoComMusica);
                $('#editarClassificacaoVocal').val(dadosEncontrados.classificacaoVocal);
                $('#editarComoSoube').val(dadosEncontrados.comoSoube);
                $('#editarTipoCoral').val(dadosEncontrados.tipoCoral);
                $('#editarGenero').val(dadosEncontrados.genero);
                $('#editarRecebeBeneficio').val(dadosEncontrados.recebeBeneficio || '');
                $('#editarusoImagem').val(dadosEncontrados.usoImagem || '');
                $('#tipoResponsavelEditar').val(dadosEncontrados.tipoResponsavel || '');
                $('#editarresponsavel').val(dadosEncontrados.responsavel || '');
                $('#editarNomePai').val(dadosEncontrados.nomePai);
                $('#editarNomeMae').val(dadosEncontrados.nomeMae);

                // Atualizar exibição do campo "Nome do Responsável" se necessário
                atualizarExibicaoResponsavelEditar();

                // Adicionar o evento de submit ao formulário de edição
                $('#formEditarCadastro').off('submit').on('submit', function(event) {
                  event.preventDefault();

                  var dadosEditados = {
                    nomeCompleto: $('#editarNomeCompleto').val(),
                    endereco: $('#editarEndereco').val(),
                    bairro: $('#editarBairro').val(),
                    cidade: $('#editarCidade').val(),
                    estado: $('#editarEstado').val(),
                    cep: $('#editarCEP').val(),
                    rg: $('#editarRG').val(),
                    cpf: $('#editarCPF').val(),
                    celular: $('#editarCelular').val(),
                    profissao: $('#editarProfissao').val(),
                    email: $('#editarEmail').val(),
                    dataNascimento: $('#editarDataNascimento').val(),
                    escolaridade: $('#editarEscolaridade').val(),
                    ligacaoComMusica: $('#editarLigacaoComMusica').val(),
                    classificacaoVocal: $('#editarClassificacaoVocal').val(),
                    comoSoube: $('#editarComoSoube').val(),
                    tipoCoral: $('#editarTipoCoral').val(),
                    status: $('#editarStatus').val(),
                    genero: $('#editarGenero').val(),
                    dataDesistencia: $('#editarDataDesistencia').val(),
                    dataCadastro: $('#editarDataCadastro').val(),
                    recebeBeneficio: $('#editarRecebeBeneficio').val(),
                    usoImagem: $('#editarusoImagem').val(),
                    tipoResponsavel: $('#tipoResponsavelEditar').val(),
                    responsavel: $('#editarresponsavel').val(),
                    nomePai: $('#editarNomePai').val(),
                    nomeMae: $('#editarNomeMae').val()
                  };

                  // Chamar a função para enviar os dados ao servidor
                  enviarEdicaoParaServidor(linhaIndiceGlobal, dadosEditados);
                });
              } else {
                alert('Erro: CPF ou Nome não encontrado nos dados.');
              }
            }

            // Função auxiliar para buscar os dados pelo CPF ou nome
            function buscarDadosPorCpfOuNome(cpf, nome) {
              // Tentar encontrar o CPF nos dados completos
              var dados = dadosCompleto.find(function(item) {
                return item.CPF === cpf;
              });

              // Se não encontrou pelo CPF ou CPF estiver vazio, buscar pelo nome
              if (!dados || !cpf) {
                dados = dadosCompleto.find(function(item) {
                  return item.NomeCompleto === nome;
                });
              }

              return dados;
            }

            function enviarEdicaoParaServidor(linha, dados) {
              google.script.run.withSuccessHandler(function(response) {
                if (response.success) {
                  alert("Dados atualizados com sucesso.");
                  fecharModal(); // Fechar o modal de edição
                  carregarDadosCadastro(); // Recarregar os dados na tabela
                } else {
                  console.error("Erro ao editar os dados:", response.message);
                  alert("Erro ao editar os dados: " + response.message);
                }
              }).withFailureHandler(function(error) {
                console.error("Erro ao conectar com o servidor:", error);
                alert("Erro ao conectar com o servidor. Por favor, tente novamente.");
              }).editarCadastro(linha, dados); // Chama a função no servidor
            }

            // Função para converter dd-mm-yyyy para yyyy-mm-dd
            function formatarData(data) {
              if (!data) return ''; // Se não houver data, retornar string vazia
              const partes = data.split('-');
              return `${partes[2]}-${partes[1]}-${partes[0]}`; // Retorna no formato yyyy-mm-dd
            }

            // Função para interligar editarDataDesistencia e editarStatus
            $('#editarDataDesistencia').on('change', function() {
              var dataDesistencia = $(this).val(); // Obtém o valor da data
              if (dataDesistencia) {
                // Se a data for preenchida, o status muda para 'Desistente'
                $('#editarStatus').val('Desistente');
              } else {
                // Se a data for removida, o status volta para 'Ativo'
                $('#editarStatus').val('Ativo');
              }
            });

            // Evento para monitorar mudanças na caixa de seleção tipoResponsavel
            const tipoResponsavel = document.getElementById('tipoResponsavel');
            if (tipoResponsavel) {
              tipoResponsavel.addEventListener('change', function() {
                const responsavelcontainer = document.getElementById('responsavelcontainer');
                const responsavelInput = document.getElementById('responsavel');

                if (responsavelcontainer && responsavelInput) {
                  if (this.value !== "") {
                    responsavelcontainer.style.display = 'block';
                    responsavelInput.focus();
                    responsavelInput.style.border = '2px solid yellow'; // Efeito de borda amarela
                  } else {
                    responsavelcontainer.style.display = 'none';
                    responsavelInput.style.border = ''; // Remover efeito de borda
                  }
                }
              });
            }

            // Evento para monitorar mudanças na caixa de seleção tipoResponsavelEditar
            const tipoResponsavelEditar = document.getElementById('tipoResponsavelEditar');
            if (tipoResponsavelEditar) {
              tipoResponsavelEditar.addEventListener('change', atualizarExibicaoResponsavelEditar);
            }

            // Função para atualizar a exibição do campo "Nome do Responsável" no modal de edição
            function atualizarExibicaoResponsavelEditar() {
              const editarResponsavelContainer = document.getElementById('editarResponsavelContainer');
              const editarResponsavelInput = document.getElementById('editarresponsavel');

              if (editarResponsavelContainer && editarResponsavelInput) {
                if (tipoResponsavelEditar.value !== "") {
                  editarResponsavelContainer.style.display = 'block';
                  editarResponsavelInput.focus();
                  editarResponsavelInput.style.border = '2px solid yellow'; // Efeito de borda amarela
                } else {
                  editarResponsavelContainer.style.display = 'none';
                  editarResponsavelInput.style.border = ''; // Remover efeito de borda
                }
              }
            }

            // Evento para monitorar mudanças na caixa de seleção detalhesTipoResponsavel
            const detalhesTipoResponsavel = document.getElementById('detalhesTipoResponsavel');
            if (detalhesTipoResponsavel) {
              detalhesTipoResponsavel.addEventListener('change', atualizarExibicaoResponsavelDetalhes);
            }

            // Função para atualizar a exibição do campo "Nome do Responsável" no modal de detalhes
            function atualizarExibicaoResponsavelDetalhes() {
              const detalhesResponsavelContainer = document.getElementById('detalhesResponsavelContainer');
              const detalhesResponsavelInput = document.getElementById('detalhesResponsavel');

              if (detalhesResponsavelContainer && detalhesResponsavelInput) {
                if (detalhesTipoResponsavel.value !== "") {
                  detalhesResponsavelContainer.style.display = 'block';
                  detalhesResponsavelInput.focus();
                  detalhesResponsavelInput.style.border = '2px solid yellow'; // Efeito de borda amarela
                } else {
                  detalhesResponsavelContainer.style.display = 'none';
                  detalhesResponsavelInput.style.border = ''; // Remover efeito de borda
                }
              }
            }

            // Função para buscar endereço pelo CEP no cadastro
            $('#cep').on('blur', function() {
              var cep = $(this).val().replace(/\D/g, '');
              if (cep.length === 8) {
                buscarEnderecoPorCEP(cep, function(endereco) {
                  if (endereco) {
                    $('#endereco').val(endereco.street);
                    $('#bairro').val(endereco.neighborhood);
                    $('#cidade').val(endereco.city);
                    $('#estado').val(endereco.state);
                  } else {
                    alert('CEP não encontrado.');
                  }
                });
              }
            });

            // Função para buscar endereço pelo CEP na edição
            $('#editarCEP').on('blur', function() {
              var cep = $(this).val().replace(/\D/g, '');
              if (cep.length === 8) {
                buscarEnderecoPorCEP(cep, function(endereco) {
                  if (endereco) {
                    $('#editarEndereco').val(endereco.street);
                    $('#editarBairro').val(endereco.neighborhood);
                    $('#editarCidade').val(endereco.city);
                    $('#editarEstado').val(endereco.state);
                  } else {
                    alert('CEP não encontrado.');
                  }
                });
              }
            });

            // Função para buscar o endereço pela API
            function buscarEnderecoPorCEP(cep, callback) {
              $.ajax({
                url: 'https://brasilapi.com.br/api/cep/v1/' + cep,
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data);
                },
                error: function() {
                  callback(null);
                }
              });
            }

            // Função para atualizar o contador de novos registros
            function atualizarContadorNovosRegistros() {
              google.script.run.withSuccessHandler(function(count) {
                $('#NotificacaoAguardando').text(count);
                $('#contador').text(count + ' aguardando aprovação');
              }).withFailureHandler(function(error) {
                console.error('Erro ao obter contador de novos registros:', error);
              }).obterContadorNovosRegistros();
            }

            // Chamar a função ao carregar a página
            atualizarContadorNovosRegistros();

            // Função para abrir o modal com os novos registros
            window.abrirNovosRegistros = function() {
              // Chamar função para obter os novos registros
              google.script.run.withSuccessHandler(function(data) {
                // Preencher a tabela com os novos registros
                if ($.fn.dataTable.isDataTable('#tabelaNovosRegistros')) {
                  $('#tabelaNovosRegistros').DataTable().clear().destroy();
                }

                // Formatar datas para o formato 'dd-mm-yyyy'
                data.forEach(function(item) {
                  item.dataNascimento = formatarDataParaBR(item.dataNascimento);
                  item.dataCadastro = formatarDataParaBR(item.dataCadastro);
                });

                var tabelaNovosRegistros = $('#tabelaNovosRegistros').DataTable({
                  data: data,
                  columns: [
                    {
                      data: 'NomeCompleto',
                      render: function(data, type, row) {
                        return '<a href="#" class="link-nome-registro" data-id="' + row.id + '">' + data + '</a>';
                      }
                    },
                    { data: 'Celular' },
                    { data: 'dataNascimento' },
                    { data: 'dataCadastro' },
                    { data: 'tipoCoral' }
                  ],
                  pageLength: 5,
                  searching: false,
                  paging: false,
                  info: false,
                  ordering: false
                });

                // Verificar se a tabela foi inicializada
                console.log('Tabela de Novos Registros:', tabelaNovosRegistros);

                // Evento de clique no nome do registro 
                $('#tabelaNovosRegistros tbody').off('click').on('click', '.link-nome-registro', function(event) {
                  event.preventDefault();

                  // Logar o elemento clicado
                  console.log('Elemento clicado:', this);

                  // Capturar a linha da tabela onde o clique ocorreu
                  var $row = $(this).parents('tr');
                  console.log('Linha da tabela:', $row);

                  // Capturar os dados da linha clicada
                  var data = tabelaNovosRegistros.row($row).data();
                  console.log('Dados capturados no clique:', data);

                  // Verificar se os dados foram capturados corretamente
                  if (data) {
                    // Chamar a função para abrir os detalhes do registro
                    abrirDetalhesRegistro(data);
                  } else {
                    console.error('Nenhum dado foi encontrado para a linha clicada.');
                  }
                });


                // Abrir o modal
                $('#modalNovosRegistros').show();
              }).withFailureHandler(function(error) {
                console.error('Erro ao obter novos registros:', error);
              }).obterNovosRegistros();
            };

            // Função para fechar o modal de novos registros
            window.fecharModalNovosRegistros = function() {
              $('#modalNovosRegistros').hide();
            };

            // Função para abrir os detalhes do registro
            function abrirDetalhesRegistro(dados) {
              console.log('Dados recebidos em abrirDetalhesRegistro:', dados);

              // Preencher os campos do formulário com os dados do registro
              $('#detalhesNomeCompleto').val(dados.NomeCompleto);
              $('#detalhesCEP').val(dados.cep);
              $('#detalhesEndereco').val(dados.Endereco);
              $('#detalhesBairro').val(dados.bairro);
              $('#detalhesCidade').val(dados.cidade);
              $('#detalhesUF').val(dados.uf);
              $('#detalhesRG').val(dados.RG);
              $('#detalhesCPF').val(dados.CPF);
              $('#detalhesCelular').val(dados.Celular);
              $('#detalhesProfissao').val(dados.Profissao);
              $('#detalhesEmail').val(dados.Email);
              $('#detalhesDataNascimento').val(formatarDataParaInput(dados.dataNascimento));
              $('#detalhesEscolaridade').val(dados.Escolaridade);
              $('#detalhesLigacaoComMusica').val(dados.ligacaoComMusica);
              $('#detalhesClassificacaoVocal').val(dados.classificacaoVocal);
              $('#detalhesComoSoube').val(dados.comoSoube);
              $('#detalhesTipoCoral').val(dados.tipoCoral);
              $('#detalhesStatus').val(dados.status);
              $('#detalhesGenero').val(dados.genero);
              $('#detalhesDataDesistencia').val(formatarDataParaInput(dados.dataDesistencia));
              $('#detalhesDataCadastro').val(formatarDataParaInput(dados.dataCadastro));
              $('#detalhesRecebeBeneficio').val(dados.recebeBeneficio);
              $('#detalhesUsoImagem').val(dados.usoImagem);
              $('#detalhesTipoResponsavel').val(dados.tipoResponsavel);
              $('#detalhesResponsavel').val(dados.responsavel);
              $('#detalhesNomePai').val(dados.nomePai);
              $('#detalhesNomeMae').val(dados.nomeMae);
              // Armazenar o ID do registro para uso posterior
              $('#formDetalhesRegistro').data('registroId', dados.id);

              // Aplicar máscaras nos campos
              aplicarMascarasDetalhes();

              // Atualizar exibição do campo "Nome do Responsável" se necessário
              atualizarExibicaoResponsavelDetalhes();


              // Abrir o modal de detalhes
              $('#modalDetalhesRegistro').show();
            }

            // Função para aplicar máscaras nos campos do modal de detalhes
            function aplicarMascarasDetalhes() {
              $('#detalhesCPF').inputmask('999.999.999-99');
              $('#detalhesCelular').inputmask('(99) 99999-9999');
              $('#detalhesCEP').inputmask('99999-999');
            }

            // Função para transferir o registro
            window.transferirRegistro = function() {
              // Obter o ID do registro
              var registroId = $('#formDetalhesRegistro').data('registroId');

              // Obter os dados do formulário
              var dados = {
                id: registroId,
                NomeCompleto: $('#detalhesNomeCompleto').val(),
                Endereco: $('#detalhesEndereco').val(),
                RG: $('#detalhesRG').val(),
                CPF: $('#detalhesCPF').val(),
                Celular: $('#detalhesCelular').val(),
                Profissao: $('#detalhesProfissao').val(),
                Email: $('#detalhesEmail').val(),
                dataNascimento: $('#detalhesDataNascimento').val(),
                Escolaridade: $('#detalhesEscolaridade').val(),
                ligacaoComMusica: $('#detalhesLigacaoComMusica').val(),
                classificacaoVocal: $('#detalhesClassificacaoVocal').val(),
                comoSoube: $('#detalhesComoSoube').val(),
                tipoCoral: $('#detalhesTipoCoral').val(),
                status: $('#detalhesStatus').val(),
                genero: $('#detalhesGenero').val(),
                dataDesistencia: $('#detalhesDataDesistencia').val(),
                dataCadastro: $('#detalhesDataCadastro').val(),
                recebeBeneficio: $('#detalhesRecebeBeneficio').val(),
                usoImagem: $('#detalhesUsoImagem').val(),
                tipoResponsavel: $('#detalhesTipoResponsavel').val(),
                responsavel: $('#detalhesResponsavel').val(),
                nomePai: $('#detalhesNomePai').val(),
                nomeMae: $('#detalhesNomeMae').val(),
                bairro: $('#detalhesBairro').val(),
                cidade: $('#detalhesCidade').val(),
                uf: $('#detalhesUF').val(),
                cep: $('#detalhesCEP').val()
              };

              // Chamar a função do servidor para transferir o registro
              google.script.run.withSuccessHandler(function(response) {
                if (response.success) {
                  alert('Registro transferido com sucesso.');

                  // Fechar o modal de detalhes
                  fecharModalDetalhesRegistro();

                  // Remover o registro da tabela de novos registros
                  var tabela = $('#tabelaNovosRegistros').DataTable();
                  tabela.row(function(idx, data, node) {
                    return data.id === registroId;
                  }).remove().draw();

                  // Atualizar o contador de novos registros
                  atualizarContadorNovosRegistros();
                } else {
                  alert('Erro ao transferir registro: ' + response.message);
                }
              }).withFailureHandler(function(error) {
                console.error('Erro ao transferir registro:', error);
                alert('Erro ao transferir registro. Por favor, tente novamente.');
              }).transferirRegistroParaAluno(dados);
            };

            // Função para fechar o modal de detalhes
            window.fecharModalDetalhesRegistro = function() {
              $('#modalDetalhesRegistro').hide();
              $('#formDetalhesRegistro')[0].reset();
            };

            // Função para formatar data para 'dd-mm-yyyy'
            function formatarDataParaBR(dataString) {
              if (!dataString) return '';
              var partes = dataString.split('-');
              return partes[2] + '-' + partes[1] + '-' + partes[0];
            }

            function formatarDataParaInput(dataString) {
              console.log('Iniciando formatarDataParaInput com dataString:', dataString);
              if (!dataString) {
                console.log('dataString é nula ou vazia.');
                return '';
              }

              var dateObj;
              // Verificar se a data está no formato 'dd-mm-yyyy' ou 'dd/mm/yyyy'
              var regexDDMMYYYY = /^(\d{2})[-\/](\d{2})[-\/](\d{4})$/;
              var partes = dataString.match(regexDDMMYYYY);
              if (partes) {
                // Converter para objeto Date
                dateObj = new Date(partes[3], partes[2] - 1, partes[1]);
              } else {
                // Tentar converter diretamente
                dateObj = new Date(dataString);
              }

              if (!isNaN(dateObj.getTime())) {
                // Formatar para 'yyyy-mm-dd'
                var ano = dateObj.getFullYear();
                var mes = ('0' + (dateObj.getMonth() + 1)).slice(-2);
                var dia = ('0' + dateObj.getDate()).slice(-2);
                var dataFormatada = ano + '-' + mes + '-' + dia;
                console.log('Data formatada para input: ', dataFormatada);
                return dataFormatada;
              } else {
                console.log('Data inválida após tentativa de parsing.');
                return '';
              }
            }
            // Funções iniciais chamadas ao carregar a página
            carregarDadosCadastro(); // Carrega os dados da tabela quando a página é carregada
            aplicarMascaras();       // Aplica as máscaras quando a página é carregada
          });

          function atualizarContagemAlunos(dados) {
            const totalCadastros = dados.length;
            let totalMesAtual = 0;
            const dataAtual = new Date();
            const mesAtual = dataAtual.getMonth();
            const anoAtual = dataAtual.getFullYear();

            dados.forEach(item => {
              if (item.dataCadastro) {
                const partes = item.dataCadastro.split('-'); // Formato dd-mm-yyyy
                if (partes.length === 3) {
                  const dia = parseInt(partes[0]);
                  const mes = parseInt(partes[1]) - 1;
                  const ano = parseInt(partes[2]);
                  const dataCadastro = new Date(ano, mes, dia);
                  if (dataCadastro.getMonth() === mesAtual && dataCadastro.getFullYear() === anoAtual) {
                    totalMesAtual++;
                  }
                }
              }
            });

            document.getElementById('totalAlunosCadastrado').textContent = '+ ' + totalCadastros;
            document.getElementById('totalMês').textContent = totalMesAtual + ' novo aluno no mês atual';

            let totalDesistente = 0;
            let totalMesdesistente = 0;
            const agora = new Date();
            let mesAtualDesistente = agora.getMonth(); // Renomeado
            const anoAtualDes = agora.getFullYear();

            dados.forEach(item => {
              if (item.dataDesistencia) {
                totalDesistente++;
                const [dia, mes, ano] = item.dataDesistencia.split('-');
                const dataDesistenciaDate = new Date(ano, mes - 1, dia);
                if (dataDesistenciaDate.getMonth() === mesAtualDesistente && dataDesistenciaDate.getFullYear() === anoAtualDes) {
                  totalMesdesistente++;
                }
              }
            });

            document.getElementById('TotalDesistente').textContent = '- ' + totalDesistente;
            document.getElementById('totalMesdesistente').textContent = totalMesdesistente + ' aluno(s) desistente no mês';
          }

          $(document).ready(function(){
      
      // Função para formatar e atualizar a data
      function atualizarDataHoje() {
        const data = new Date();
        const opcoes = { 
          weekday: 'long', 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        };
        const dataFormatada = data.toLocaleDateString('pt-BR', opcoes);
        const dataFinal = dataFormatada.charAt(0).toUpperCase() + dataFormatada.slice(1);
        $('#dataHoje').text(dataFinal);
      }
    
      // Atualizar data imediatamente e a cada 1 minuto
      atualizarDataHoje();
      setInterval(atualizarDataHoje, 60000);
      
     
    });

   <!-- Pagina Frequencia --> 

    </script>


          <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
          <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
          <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>

          <!-- dados para guia codigo-->
          <script>
          
          </script>

          <div class="container mt-4">
            <div class="row mb-3">
              <div class="col-md-12">
                <input type="text" id="search-bar" class="form-control" placeholder="buscar...">
              </div>
            </div>
          </div>
        </div>
      </div>

  <!-- Inicio da pagina frequencia -->
     <div id="flights" class="main_container">
  <div class="titulo-cadastro-container">
    <h2>Frequência</h2>
    <p>Visão geral</p>
  </div>
  
  <!-- Contêiner principal da página filha com classe renomeada -->

  <div class="container-header">
    <div class="header">
      <h1>Inserção de Frequências dos Corais - <span id="currentYear"></span></h1>
    </div>
  </div>
<!-- Contêiner principal da página filha com classe renomeada -->
  <div class="container">
    <div class="child-main-container">
      <!-- Barra superior para os meses -->
      <div class="top-bar">
        <div class="month-container" id="monthContainer"></div>
         <!-- Botões dos meses são gerados via JS -->
      </div>

     <!-- Contêiner para alinhar checkbox-container e calendário e cards -->
      <div class="alignment-container">
        
        <!-- Sidebar para checkboxes -->
        <div class="checkbox-container">
          <label class="checkbox-label">
            <input type="checkbox" id="AlgazarraCoral" class="checkbox-input" checked />
            <span class="checkbox-custom"></span>
            Algazarra Coral
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="CoralUnimed" class="checkbox-input" />
            <span class="checkbox-custom"></span>
            Coral Unimed
          </label>
        </div>

        <!-- Contêiner para calendário e cards -->
        <div class="calendar-cards-container">
          <!-- Contêiner principal para o calendário -->
          <div class="calendario-grid">
            <div class="calendar" id="calendar">
              <!-- Dias do calendário serão gerados dinamicamente -->
            </div>
          </div>

          <!-- Contêiner para os cards -->
            <div class="cards-container">
            <div id="CardMes" class="card custom-card">
              <h3>Aulas no Mês</h3>
              <p id="aulasMes">0</p>
            </div>
            <div id="CardAno" class="card custom-card">
              <h3>Total de Aulas no Ano</h3>
              <p id="aulasAno">0</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Contêiner para o controle de frequência -->
      <div class="TableFrequencia-container">
        <h2>Controle de Frequência</h2>
        <div class="filter-container">
          <label for="btnfiltroAno">Ano</label>
          <input type="text" id="btnfiltroAno" class="btnfiltroMes" placeholder="Ex: 2024">

          <label for="btnfiltroMes">Mês</label>
          <input type="text" id="btnfiltroMes" class="btnfiltroMes" placeholder="Ex: Jan">

          <label for="btnfiltroAluno">Aluno</label>
          <input type="text" id="btnfiltroAluno" class="btnfiltroaluno" placeholder="Nome do Aluno">
        </div>

        <!-- Tabela para exibir os dados -->
        <table id="tabelaFrequencia" class="display" style="width:100%">
          <thead>
            <tr>
              <th rowspan="2">Nome Completo</th>
              <th rowspan="2">Ano</th>
              <th rowspan="2">Mês</th>
              <th rowspan="2">Tipo Coral</th>
              <th colspan="3">Frequência</th>
              <!--  <th rowspan="2">Frequência Anual</th> -->
            </tr>
            <tr>
              <th>Presente</th>
              <th>Falta</th>
              <th>Atestado</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dados dinâmicos serão carregados aqui -->
          </tbody>
        </table>
      </div>

      <!-- Modal de Presença -->
      <div id="modalPresenca" class="modal" style="display: none;">
        <div class="modal-content">
          <!-- Card para o título -->
          <div class="modal-header card">
            <h3>Lista de Presença - Dia</h3>
          </div>

          <!-- Card para Hora de Início e Fim -->
          <div class="modal-horarios card">
            <label for="horaInicio">Hora de Início:</label>
            <input type="time" id="horaInicio">
            <label for="horaFim">Hora de Fim:</label>
            <input type="time" id="horaFim">
          </div>

          <!-- Card para o título 'Coristas' -->
          <div class="modal-coristas card">
            <h4>CORISTAS</h4>
          </div>

          <!-- Tabela de Presença dos Coristas -->
          <table id="studentTable">
            <thead>
              <tr>
                <th>Ord</th>
                <th>Nome do Aluno</th>
                <th>Presença</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="studentList">
              <!-- As linhas dos alunos serão populadas dinamicamente -->
            </tbody>
          </table>

          <!-- Botões -->
          <div class="modal-actions">
            <button id="salvar" class="btn-save">Salvar</button>
            <button id="fechar" class="btn-close" onclick="fecharModal()">Fechar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- DataTables -->
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

  <!-- Seu script principal -->
  <script>
    $(document).ready(function() {
  console.log("Iniciando script principal.");

  // Definição das variáveis globais dentro do escopo do ready
  const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
  const diasSemana = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S']; // Cabeçalhos simplificados
  let mesAtivo = new Date().getMonth() + 1; // Mês atual (1-12)
  const anoAtual = new Date().getFullYear(); // Ano atual

  try {
    // Preencher o ano corrente no título da página
    $('#currentYear').text(anoAtual);
    console.log("Ano corrente preenchido:", $('#currentYear').text());

    const monthContainer = $('#monthContainer');
    console.log("Contêiner dos meses obtido:", monthContainer);

    // Gerar os botões dos meses dinamicamente
    gerarBotoesMeses();

    // Define o mês ativo e atualiza o calendário e os cards
    setActiveMonth(mesAtivo);

    // Carrega a tabela de frequência
    carregarTabelaFrequencia();

    // Adicionar event listener aos checkboxes para recarregar a tabela quando o coral selecionado mudar
    $('.checkbox-input').on('change', function() {
      console.log(`Checkbox ${this.id} alterado para ${this.checked}`);

      if (this.checked) {
        // Desmarcar todas as outras checkboxes
        $('.checkbox-input').not(this).prop('checked', false).removeClass('checked');
        console.log(`Checkbox ${this.id} está marcada. Outras checkboxes desmarcadas.`);
      } else {
        console.log(`Checkbox ${this.id} foi desmarcada.`);
      }

      carregarTabelaFrequencia();
    });

    // Atualizar a classe 'checked' ao carregar a página
    $('.checkbox-input').each(function() {
      if ($(this).is(':checked')) {
        $(this).addClass('checked');
        console.log(`Checkbox ${this.id} marcado como 'checked'.`);
      } else {
        $(this).removeClass('checked');
        console.log(`Checkbox ${this.id} removido da classe 'checked'.`);
      }
    });

    // Inicializar o DataTable
    inicializarDataTable();

    // Event listeners para os inputs de filtro
    $('#btnfiltroAno, #btnfiltroMes, #btnfiltroAluno').on('keyup change clear', function() {
      aplicarFiltros();
    });

    // Event listener para o botão de salvar no modal
    $('#salvar').on('click', function() {
      console.log("Botão 'Salvar' clicado.");
      salvarPresenca();
    });

  } catch (error) {
    console.error("Erro durante a inicialização:", error);
  }

  // ==================== FUNÇÕES ====================

  /**
   * Função para obter o número de dias em um determinado mês e ano
   * @param {number} mes - Mês desejado (1-12)
   * @param {number} ano - Ano desejado
   * @returns {number} - Número de dias no mês
   */
  function obterDiasNoMes(mes, ano) {
    try {
      const dias = new Date(ano, mes, 0).getDate();
      console.log(`Número de dias no mês ${mes} do ano ${ano}: ${dias}`);
      return dias;
    } catch (error) {
      console.error("Erro na função 'obterDiasNoMes':", error);
      return 0;
    }
  }

  /**
   * Função para obter o dia da semana do primeiro dia do mês
   * @param {number} mes - Mês desejado (1-12)
   * @param {number} ano - Ano desejado
   * @returns {number} - Dia da semana (0=Domingo)
   */
  function obterDiaSemanaPrimeiroDia(mes, ano) {
    try {
      const diaSemana = new Date(ano, mes - 1, 1).getDay();
      console.log(`Dia da semana do primeiro dia do mês ${mes} do ano ${ano}: ${diaSemana}`);
      return diaSemana;
    } catch (error) {
      console.error("Erro na função 'obterDiaSemanaPrimeiroDia':", error);
      return 0;
    }
  }

  /**
   * Função para gerar os botões dos meses dinamicamente.
   */
  function gerarBotoesMeses() {
    console.log("Iniciando geração dinâmica dos botões dos meses.");
    try {
      meses.forEach((mes, index) => {
        console.log(`Criando botão para o mês: ${mes}`);
        const buttonMes = $('<button>')
          .addClass('mes-button')
          .text(mes)
          .attr('data-mes', index + 1);

        // Verificar se o mês atual é o ativo
        if (index + 1 === mesAtivo) {
          buttonMes.addClass('active');
          console.log(`Botão do mês ${mes} marcado como ativo.`);
        }

        // Evento de clique no mês para gerar o calendário correspondente
        buttonMes.on('click', function() {
          const selectedMes = parseInt($(this).attr('data-mes'));
          console.log(`Botão do mês ${mes} clicado. Mês selecionado: ${selectedMes}`);
          setActiveMonth(selectedMes);
        });

        // Adiciona o mês gerado ao container como elemento DOM
        buttonMes.appendTo(monthContainer);
        console.log(`Botão do mês ${mes} adicionado ao container.`);
      });
      console.log("Geração dinâmica dos botões dos meses concluída.");
    } catch (error) {
      console.error("Erro na função 'gerarBotoesMeses':", error);
    }
  }

  /**
 * Função para definir o mês ativo, atualizar a classe 'active', gerar o calendário e atualizar os cards.
 * @param {number} mes - Número do mês (1-12).
 */
function setActiveMonth(mes) {
  console.log(`Definindo o mês ativo para: ${mes}`);
  mesAtivo = mes; // Atualiza o mês ativo

  // Atualizar a classe 'active' nos botões
  console.log("Atualizando classes 'active' nos botões dos meses.");
  $('.mes-button').each(function() {
    if (parseInt($(this).attr('data-mes')) === mes) {
      $(this).addClass('active');
      console.log(`Botão do mês ${$(this).text()} marcado como ativo.`);
    } else {
      $(this).removeClass('active');
      console.log(`Botão do mês ${$(this).text()} desmarcado.`);
    }
  });

  // Chamar a função que gera o calendário para o mês selecionado
  console.log(`Gerando calendário para o mês ${mesAtivo} e ano ${anoAtual}.`);
  gerarCalendario(mesAtivo, anoAtual);

  // Chamar a função para atualizar as contagens
  console.log(`Atualizando contagens de aulas para o mês ${mesAtivo} e ano ${anoAtual}.`);
  RecebeMesAnoContagem(mesAtivo, anoAtual);

  // Recarregar a tabela de frequência com base no mês ativo e tipo de coral selecionado
  console.log(`Recarregando a tabela de frequência para o mês ${mesAtivo}.`);
  carregarTabelaFrequencia();
}

  /**
   * Função para gerar o calendário baseado no mês e ano selecionados
   * @param {number} mes - Mês selecionado (1-12)
   * @param {number} ano - Ano selecionado
   */
  function gerarCalendario(mes, ano) {
    console.log(`Gerando calendário para o mês ${mes} e ano ${ano}.`);
    try {
      const calendar = $('#calendar'); // Contêiner do calendário
      calendar.empty(); // Limpa o calendário atual antes de gerar um novo
      console.log("Calendário limpo.");

      // Criar uma div para o grid do calendário, contendo cabeçalhos e dias
      const calendarioGrid = $('<div>').addClass('calendario-grid');
      console.log("Div 'calendario-grid' criada.");

      // Adicionar cabeçalhos dos dias da semana
      diasSemana.forEach((dia, index) => {
        const divHeader = $('<div>').addClass('day-header').text(dia);
        if (index === 0 || index === 6) { // Domingo e Sábado
          divHeader.addClass('weekend');
          console.log(`Cabeçalho do dia ${dia} marcado como fim de semana.`);
        }
        calendarioGrid.append(divHeader); // Adiciona os cabeçalhos ao grid
      });
      console.log("Cabeçalhos dos dias da semana adicionados ao calendário.");

      // Número de dias no mês selecionado
      const diasNoMes = obterDiasNoMes(mes, ano);

      // Determina em qual dia da semana o mês começa
      let diaSemanaInicio = obterDiaSemanaPrimeiroDia(mes, ano);
      if (diaSemanaInicio === 0) diaSemanaInicio = 7; // Ajusta para que a semana comece na segunda
      console.log(`Dia da semana ajustado para início do mês: ${diaSemanaInicio}`);

      // Preencher os dias em branco no início do mês (dias anteriores ao primeiro do mês)
      for (let i = 1; i < diaSemanaInicio; i++) {
        const divVazio = $('<div>').addClass('vazio');
        calendarioGrid.append(divVazio); // Adiciona dias vazios ao grid
        console.log("Dia vazio adicionado ao calendário.");
      }

      // Gerar os dias do mês e adicioná-los ao calendário
      for (let dia = 1; dia <= diasNoMes; dia++) {
        const divDia = $('<div>').addClass('day').text(dia);
        console.log(`Criando dia ${dia} do mês.`);

        // Identificar finais de semana (Sábado e Domingo)
        const diaSemanaAtual = (diaSemanaInicio + dia - 2) % 7;
        if (diaSemanaAtual === 0 || diaSemanaAtual === 6) { // Domingo e Sábado
          divDia.addClass('weekend'); // Adiciona uma classe especial para finais de semana
          console.log(`Dia ${dia} marcado como fim de semana.`);
        }

        // Adiciona um evento de clique para abrir o modal ao clicar no dia
        divDia.on('click', function() {
          console.log(`Dia ${dia} clicado. Abrindo modal de presença.`);
          abrirModal(dia); // Chama a função para abrir o modal de presença
        });

        // Adiciona o dia gerado ao calendário
        calendarioGrid.append(divDia);
        console.log(`Dia ${dia} adicionado ao calendário.`);
      }

      calendar.append(calendarioGrid); // Adiciona o grid completo ao calendário principal
      console.log("Calendário completo adicionado ao DOM.");
    } catch (error) {
      console.error("Erro na função 'gerarCalendario':", error);
    }
  }

  /**
 * Função para atualizar os cards recebendo os dados do servidor.
 * @param {number} mes - Número do mês (1-12).
 * @param {number} ano - Ano corrente.
 */
function RecebeMesAnoContagem(mes, ano) {
  console.log(`RecebeMesAnoContagem: Carregando contagens para o mês ${mes} e ano ${ano}.`);

  // Mostrar o spinner de carregamento
  console.log("Exibindo spinner de carregamento.");
  $('#loadingSpinner').show();

  // Obter o tipo de coral selecionado para passar ao servidor
  const tipoCoral = obterTipoCoralSelecionado();
  console.log(`Tipo de coral para contagem: ${tipoCoral}`);

  // Chamar a função do servidor via Google Apps Script
  google.script.run.withSuccessHandler(function(response){
    console.log("Resposta do servidor recebida:", response);
    // Atualiza os elementos do DOM com os dados recebidos
    $('#aulasMes').text(response.aulasMes);
    $('#aulasAno').text(response.aulasAno);
    console.log(`Cards atualizados: aulasMes=${response.aulasMes}, aulasAno=${response.aulasAno}`);

    // Ocultar o spinner de carregamento
    console.log("Ocultando spinner de carregamento.");
    $('#loadingSpinner').hide();
  }).withFailureHandler(function(error){
    console.error('Erro ao obter dados:', error);
    alert('Ocorreu um erro ao carregar os dados. Por favor, tente novamente.');
    // Ocultar o spinner de carregamento em caso de erro
    console.log("Ocultando spinner de carregamento devido a erro.");
    $('#loadingSpinner').hide();
  }).TrazMesAnoContagem(mes, ano, tipoCoral); // Passa tipoCoral como terceiro parâmetro
}

  /**
   * Função para abrir o modal de presença e buscar dados do servidor
   * @param {number} dia - Dia selecionado
   */
  function abrirModal(dia) {
    console.log(`Abrindo modal de presença para o dia ${dia}.`);
    try {
      const modal = $('#modalPresenca');
      const studentList = $('#studentList');

      // Verificar quais checkboxes estão marcadas
      const isAlgazarraChecked = $('#AlgazarraCoral').is(':checked');
      const isCoralUnimedChecked = $('#CoralUnimed').is(':checked');
      console.log(`AlgazarraCoral está ${isAlgazarraChecked ? 'marcada' : 'desmarcada'}.`);
      console.log(`CoralUnimed está ${isCoralUnimedChecked ? 'marcada' : 'desmarcada'}.`);

      // Validar que pelo menos um filtro está selecionado
      if (!isAlgazarraChecked && !isCoralUnimedChecked) {
        console.log("Nenhum coral selecionado. Modal não será aberto.");
        alert('Por favor, selecione um coral para continuar.');
        return; // Não abre o modal se nenhum checkbox estiver marcado
      }

      // Definir o tipo de coral com base nas checkboxes marcadas
      let tipoCoral = [];
      if (isAlgazarraChecked) tipoCoral.push('AlgazarraCoral');
      if (isCoralUnimedChecked) tipoCoral.push('CoralUnimed');
      tipoCoral = tipoCoral.join(', '); // Pode ser múltiplos tipos
      console.log(`Tipo de coral selecionado: ${tipoCoral}`);

      // Obter o mês ativo e o ano corrente
      const mesAtivoNome = $('.mes-button.active').text(); // Nome do mês ativo
      const mesAtivoIndex = meses.indexOf(mesAtivoNome) + 1; // Posição do mês ativo (de 1 a 12)
      console.log(`Mês ativo: ${mesAtivoNome} (${mesAtivoIndex}), Ano corrente: ${anoAtual}`);

      // Formatar a data no formato ISO yyyy-mm-dd
      const diaFormatado = ('0' + dia).slice(-2); // Garantir que o dia tenha 2 dígitos
      const mesFormatado = ('0' + mesAtivoIndex).slice(-2); // Garantir que o mês tenha 2 dígitos
      const dataCompleta = `${anoAtual}-${mesFormatado}-${diaFormatado}`; // Formatar a data como yyyy-mm-dd
      console.log(`Data completa (ISO): ${dataCompleta}`);

      // Converter a data para o formato PT-BR dd-mm-yyyy
      const dataPTBR = `${diaFormatado}-${mesFormatado}-${anoAtual}`;
      console.log(`Data completa (PT-BR): ${dataPTBR}`);

      // Preencher o dia, mês e ano selecionado no header do modal
      $('.modal-header h3').text(`Lista de Presença - ${dataPTBR} (${tipoCoral})`);
      console.log("Título do modal atualizado.");

      // Exibir spinner de carregamento e bloquear interações
      console.log("Exibindo spinner de carregamento e desabilitando interações com o modal.");
      $('#loadingSpinner').show();
      modal.css('pointer-events', 'none'); // Desabilita interações com o modal enquanto carrega

      // Limpar a lista de presença e os campos de hora
      studentList.empty(); // Limpar o conteúdo da tabela antes de preencher novos dados
      $('#horaInicio').val('');
      $('#horaFim').val('');
      console.log("Conteúdo do modal limpo.");

      // Chamar a função no servidor para obter os alunos do coral selecionado
      console.log(`Chamando função do servidor para obter alunos do coral: ${tipoCoral}`);
      google.script.run.withSuccessHandler(function(alunos){
        console.log("Resposta do servidor recebida: alunos", alunos);
        // Ocultar o spinner de carregamento
        console.log("Ocultando spinner de carregamento e habilitando interações com o modal.");
        $('#loadingSpinner').hide();
        modal.css('pointer-events', 'auto'); // Habilita interações novamente

        // Preencher a lista de alunos no modal
        alunos.forEach((aluno, index) => {
          console.log(`Adicionando aluno ${index + 1}: ${aluno.nome}, Status: ${aluno.status}`);
          // Criar uma linha para cada aluno
          const row = $('<tr>');

          // Adicionar uma classe especial para estilizar a linha de alunos com status "Desistente"
          if (aluno.status === 'Desistente') {
            row.addClass('desistente'); // Adiciona a classe 'desistente'
            console.log(`Aluno ${aluno.nome} marcado como 'Desistente'.`);
          }

          // Coluna 1: Ordem (baseada no índice)
          const ordemCell = $('<td>').text(index + 1);
          row.append(ordemCell);

          // Coluna 2: Nome do Aluno
          const nomeCell = $('<td>').addClass('nomeCell').text(aluno.nome);
          row.append(nomeCell);

          // Coluna 3: Dropdown de Presença (Presente, Faltou, Atestado)
          const statusCell = $('<td>').addClass('presencaDropdown');
          const dropdown = $('<select>').append(
            $('<option>').val('Presente').text('Presente'),
            $('<option>').val('Faltou').text('Faltou'),
            $('<option>').val('Atestado').text('Atestado')
          );

          // Se o aluno for 'Desistente', desabilitar o dropdown e deixar o valor vazio
          if (aluno.status === 'Desistente') {
            dropdown.val(''); // Define o valor da dropdown como vazio
            dropdown.prop('disabled', true); // Desabilita o dropdown
            row.css('border', '2px solid #cc3b2c'); // Aplica a borda vermelha na linha
            console.log(`Dropdown de presença desabilitado para o aluno ${aluno.nome}.`);
          }

          statusCell.append(dropdown);
          row.append(statusCell);

          // Coluna 4: Status do Aluno
          const alunoStatusCell = $('<td>').addClass('statusCell').text(aluno.status);
          row.append(alunoStatusCell);

          // Adicionar a linha à tabela
          studentList.append(row);
          console.log(`Linha do aluno ${aluno.nome} adicionada à tabela de presença.`);
        });

        // Mostrar o modal
        modal.show();
        console.log("Modal de presença exibido.");
      }).withFailureHandler(function(error){
        console.error('Erro ao buscar alunos:', error);
        alert('Erro ao carregar a lista de alunos. Por favor, tente novamente.');
        $('#loadingSpinner').hide(); // Ocultar spinner em caso de erro
        modal.css('pointer-events', 'auto'); // Reabilitar interações em caso de erro
        console.log("Spinner ocultado e interações habilitadas após erro.");
      }).obterAlunosPorCoral(tipoCoral); // Passa o tipo do coral selecionado para o servidor
    } catch (error) {
      console.error("Erro na função 'abrirModal':", error);
    }
  }

  /**
   * Função para inicializar o DataTable
   */
  function inicializarDataTable() {
    console.log("Inicializando DataTable para #tabelaFrequencia.");
    try {
      $('#tabelaFrequencia').DataTable({
        "paging": true,        // Ativar paginação
        "lengthChange": true,  // Permitir ao usuário alterar o número de registros por página
        "searching": true,     // Ativar a pesquisa (necessário para os filtros)
        "ordering": true,      // Permitir ordenação das colunas
        "info": true,          // Exibir informações da tabela
        "autoWidth": false,    // Desativar largura automática
        "dom": 'lrtip',        // Ocultar a barra de pesquisa global
        "language": {
          "sEmptyTable": "Nenhum registro encontrado",
          "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
          "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
          "sInfoFiltered": "(Filtrados de _MAX_ registros)",
          "sLengthMenu": "Mostrar _MENU_ registros",
          "sLoadingRecords": "Carregando...",
          "sProcessing": "Processando...",
          "sZeroRecords": "Nenhum registro encontrado",
          "sSearch": "Pesquisar",
          "oPaginate": {
            "sNext": "Próximo",
            "sPrevious": "Anterior",
            "sFirst": "Primeiro",
            "sLast": "Último"
          },
          "oAria": {
            "sSortAscending": ": Ordenar colunas de forma ascendente",
            "sSortDescending": ": Ordenar colunas de forma descendente"
          }
        }
      });
      console.log("DataTable inicializado com sucesso.");
    } catch (error) {
      console.error("Erro durante a inicialização do DataTable:", error);
    }
  }

  /**
 * Função para carregar a tabela de frequência com os dados do servidor
 */
function carregarTabelaFrequencia() {
  console.log("Iniciando carregamento da tabela de frequência.");
  try {
    const tipoCoral = obterTipoCoralSelecionado();
    console.log(`Tipo de coral para carregamento da tabela: ${tipoCoral}`);
    console.log(`Mês ativo para carregamento da tabela: ${mesAtivo}`);

    // Exibir spinner de carregamento
    console.log("Exibindo spinner de carregamento para tabela de frequência.");
    $('#loadingSpinner').show();

    // Chamar a função do servidor para obter os dados de frequência
    google.script.run.withSuccessHandler(function(dados){
      console.log("Dados de frequência recebidos do servidor:", dados);
      // Ocultar o spinner de carregamento
      console.log("Ocultando spinner de carregamento para tabela de frequência.");
      $('#loadingSpinner').hide();

      // Atualizar a tabela com os dados recebidos
      atualizarTabelaFrequencia(dados);
    }).withFailureHandler(function(error){
      console.error('Erro ao carregar dados de frequência:', error);
      alert('Erro ao carregar dados de frequência. Tente novamente.');
      $('#loadingSpinner').hide();
      console.log("Spinner ocultado após erro no carregamento da tabela de frequência.");
    }).frequenciaCalculada(tipoCoral, mesAtivo); // Passa mesAtivo como segundo parâmetro
  } catch (error) {
    console.error("Erro na função 'carregarTabelaFrequencia':", error);
  }
}

  /**
   * Função para atualizar a tabela de frequência com os dados fornecidos
   * @param {Array} dados - Array de objetos com os dados de frequência
   */
  function atualizarTabelaFrequencia(dados) {
    console.log("Atualizando tabela de frequência com novos dados.");
    try {
      // Limpa o conteúdo existente da tabela
      const tabela = $('#tabelaFrequencia').DataTable();
      tabela.clear();
      console.log("Tabela de frequência limpa.");

      // Adiciona os novos dados
      dados.forEach(dado => {
        console.log(`Adicionando linha para o aluno: ${dado.nome}`);
        tabela.row.add([
          dado.nome,
          dado.ano,
          dado.mes,
          dado.tipoCoral,
          dado.presente,
          dado.falta,
          dado.atestado,
          dado.frequenciaAnual
        ]);
      });
      tabela.draw(false);
      console.log("Tabela de frequência atualizada com novos dados.");
    } catch (error) {
      console.error("Erro na função 'atualizarTabelaFrequencia':", error);
    }
  }

  /**
   * Função para aplicar filtros personalizados na tabela de frequência
   */
  function aplicarFiltros() {
    console.log("Aplicando filtros personalizados na tabela de frequência.");
    try {
      const tabela = $('#tabelaFrequencia').DataTable();
      const anoFiltro = $('#btnfiltroAno').val().toLowerCase();
      const mesFiltro = $('#btnfiltroMes').val().toLowerCase();
      const alunoFiltro = $('#btnfiltroAluno').val().toLowerCase();

      tabela.columns(1).search(anoFiltro);    // Coluna Ano
      tabela.columns(2).search(mesFiltro);    // Coluna Mês
      tabela.columns(0).search(alunoFiltro);  // Coluna Nome Completo

      tabela.draw();
      console.log("Filtros aplicados e tabela reprocessada.");
    } catch (error) {
      console.error("Erro na função 'aplicarFiltros':", error);
    }
  }

  /**
   * Função para obter o tipo de coral selecionado
   */
  function obterTipoCoralSelecionado() {
    const algazarraCheckbox = $("#AlgazarraCoral");
    const unimedCheckbox = $("#CoralUnimed");

    // Ativar AlgazarraCoral por padrão se nenhum estiver selecionado
    if (!algazarraCheckbox.is(':checked') && !unimedCheckbox.is(':checked')) {
      console.log("Nenhum coral selecionado. Ativando AlgazarraCoral por padrão.");
      algazarraCheckbox.prop('checked', true).addClass('checked');
    }

    let tipoCoral = [];
    if (algazarraCheckbox.is(':checked')) tipoCoral.push('AlgazarraCoral');
    if (unimedCheckbox.is(':checked')) tipoCoral.push('CoralUnimed');
    tipoCoral = tipoCoral.join(', '); // Pode ser múltiplos tipos
    console.log(`Tipo de coral selecionado: ${tipoCoral}`);

    return tipoCoral;
  }

});

/**
 * Função para salvar os dados de presença no servidor
 * Esta função está fora do $(document).ready) para que possa ser chamada via onclick diretamente
 */
function salvarPresenca() {
  console.log("Iniciando processo de salvamento de presença.");
  try {
    // Capturar a data completa do modal (removendo "Lista de Presença - ")
    const dataCompletaComCoral = $('.modal-header h3').text().replace('Lista de Presença - ', '');
    console.log("Data completa com coral capturada:", dataCompletaComCoral);

    if (!dataCompletaComCoral) {
      console.error("Erro: Não foi possível capturar a data completa do modal.");
      alert("Erro: Não foi possível capturar a data do modal.");
      return;
    }

    // Separar a data do tipo de coral
    const [dataCompletaOriginal, tipoCoral] = dataCompletaComCoral.split(' ('); // Divide entre a data e o tipo de coral
    const dataCompleta = dataCompletaOriginal.trim(); // Data formatada (dd-mm-yyyy)
    const tipoCoralFinal = tipoCoral ? tipoCoral.replace(')', '').trim() : ''; // Remove o parêntese final do tipo de coral
    console.log(`Data completa original: ${dataCompleta}, Tipo de coral final: ${tipoCoralFinal}`);

    // Converter a data de dd-mm-yyyy para o formato yyyy-mm-dd (para salvar no servidor)
    const [dia, mes, ano] = dataCompleta.split('-');
    const dataISO = `${ano}-${mes}-${dia}`;
    console.log(`Data no formato ISO para salvar: ${dataISO}`);

    // Capturar a hora de início e fim
    const horaInicio = $('#horaInicio').val();
    const horaFim = $('#horaFim').val();
    console.log(`Horas capturadas: Início - ${horaInicio}, Fim - ${horaFim}`);

    if (!horaInicio || !horaFim) {
      console.log("Horas de início ou fim não preenchidas.");
      alert('Por favor, preencha os horários de início e fim.');
      return;
    }

    // Obter as linhas da tabela de presença
    const linhasCoristas = $('#studentList tr');
    console.log(`Número de linhas de coristas na tabela: ${linhasCoristas.length}`);

    if (linhasCoristas.length === 0) {
      console.error("Erro: Não há alunos listados no modal.");
      alert("Erro: Não há alunos listados.");
      return;
    }

    // Criar um array para armazenar os dados dos alunos
    let dadosAlunos = [];
    console.log("Iniciando captura dos dados dos alunos.");

    // Iterar sobre cada linha e capturar os valores
    let erroPresenca = false;
    linhasCoristas.each(function(index, linha) {
      const nome = $(linha).find('.nomeCell').text();
      const presenca = $(linha).find('.presencaDropdown select').val();
      const status = $(linha).find('.statusCell').text();
      console.log(`Aluno: ${nome}, Presença: ${presenca}, Status: ${status}`);

      // Verificar se o campo de presença foi preenchido
      if (!presenca && status !== 'Desistente') {
        console.log(`Presença não preenchida para o aluno ${nome}.`);
        alert(`Por favor, preencha o status de presença para ${nome}.`);
        erroPresenca = true;
        return false; // Sai do loop
      }

      // Criar um objeto com os dados do aluno
      let alunoDados = {
        nome: nome,
        presenca: presenca,
        status: status,
        horaInicio: horaInicio,
        horaFim: horaFim,
        dataCompleta: dataISO,
        tipoCoral: tipoCoralFinal
      };
      console.log(`Dados capturados para o aluno ${nome}:`, alunoDados);

      // Adicionar os dados do aluno ao array
      dadosAlunos.push(alunoDados);
    });

    if (erroPresenca) {
      console.log("Erro na captura dos dados de presença. Processo interrompido.");
      return;
    }

    if (dadosAlunos.length === 0) {
      console.log("Nenhum dado válido encontrado para salvar.");
      alert("Erro: Nenhum dado válido foi encontrado para salvar.");
      return;
    }

    // Confirmação antes de salvar
    if (!confirm('Deseja realmente salvar os dados de presença?')) {
      console.log("Usuário cancelou o salvamento.");
      return;
    }

    // Exibir spinner de carregamento
    console.log("Exibindo spinner de carregamento para salvar dados.");
    $('#loadingSpinner').show();

    // Enviar os dados para o servidor
    google.script.run.withSuccessHandler(function(response){
      console.log('Resposta do servidor após salvar:', response);
      alert('Dados de presença salvos com sucesso!');
      fecharModal(); // Fechar o modal após o salvamento bem-sucedido
      console.log("Modal fechado após salvamento.");
      $('#loadingSpinner').hide(); // Ocultar spinner
    }).withFailureHandler(function(error){
      console.error('Erro ao salvar os dados no servidor:', error);
      alert('Erro ao salvar os dados. Tente novamente.');
      $('#loadingSpinner').hide(); // Ocultar spinner em caso de erro
      console.log("Spinner ocultado após erro no salvamento.");
    }).salvarPresencaServidor(dadosAlunos);
  } catch (error) {
    console.error("Erro na função 'salvarPresenca':", error);
  }
}

/**
 * Função para fechar o modal e limpar os campos
 */
function fecharModal() {
  console.log("Fechando modal de presença.");
  try {
    const modal = $('#modalPresenca');
    modal.hide();

    // Limpar os campos do modal
    modal.find('input[type="text"], input[type="time"]').val('');
    modal.find('select').prop('selectedIndex', 0);
    modal.find('input[type="checkbox"], input[type="radio"]').prop('checked', false);
    modal.find('textarea').val('');
    modal.find('tr.desistente').removeClass('desistente').css('border', '');
    console.log("Campos do modal de presença limpos.");
  } catch (error) {
    console.error("Erro na função 'fecharModal':", error);
  }
}

  </script>
</div>

           


      <div id="wallet" class="main_container">
        <h1>Carteira</h1>
        <p>Em breve</p>

      </div>
      <div id="reports" class="main_container">
        <h1>FAQS</h1>
        <p>Leia aqui nossa política de adesão</p>
        <div class="faq-container"></div>
      </div>
      <div id="details" class="main_container">
        <h1>Perfil</h1>
        <p>Tudo sobre suas informações</p>
        <div class="container">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="userUsername">Username:</label>
                <input type="text" id="userUsername" class="form-control" readonly>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="userEmail">Email:</label>
                <input type="text" id="userEmail" class="form-control" readonly>
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-md-6">
              <div class="form-group">
                <label for="userMobile">Contato:</label>
                <input type="text" id="userMobile" class="form-control" readonly>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="userCountry">País:</label>
                <input type="text" id="userCountry" class="form-control" readonly>
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-md-6">
              <div class="form-group">
                <label for="userPostal">Código Postal:</label>
                <input type="text" id="userPostal" class="form-control" readonly>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    function fetchCodigos() {
      google.script.run.withSuccessHandler(populateDataTable).getDataCodigos();
    }
    // Acionar a função quando a aba "Códigos" for aberta
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('[data-target="flights"]').addEventListener('click', function() {
        fetchCodigos();
      });
    });
    // Acionar os meus codigos na tabela
    function populateDataTable(data) {
      var dataTable = $('#dataTable').DataTable();
      dataTable.clear();
      data.forEach(function(row) {
        dataTable.row.add([
          row[0], // Titulo
          // row[1],  // Texto (Código) converitod em botão webapp
          '<button class="btn btn-outline-secondary webApp" onclick="window.open(\'' + row[1] + '\', \'_blank\')">Webapp</button>', // URL do Vídeo
          '<button class="btn btn-primary watchNow" onclick="window.open(\'' + row[2] + '\', \'_blank\')">Img Cód</button>', // URL do Vídeo
          '<button class="btn btn-success googleSheet" onclick="window.open(\'' + row[3] + '\', \'_blank\')">Google Sheet</button>' // Arquivo URL
        ]).draw();
      });
    }

    function logout() {
      Swal.fire({
        title: 'Deseja sair?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, Sair',
        cancelButtonText: 'Cancel',
        confirmButtonColor: '#dc3545'
      }).then((result) => {
        if (result.isConfirmed) {
          document.getElementById('loginSection').style.display = 'block';
          document.getElementById('mainContent').style.display = 'none';
          document.getElementById('loginForm').reset();
        }
      });
    }
    // Exibe diretamente ao carregar a página
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('mainContent').style.display = 'block';
    });
    // Abrir modal ao clicar no botão "+ Add"
    document.getElementById('addButton').addEventListener('click', function() {
      $('#addModal').modal('show');
    });
    // Submeter formulário e adicionar dados à planilha
    document.getElementById('addForm').addEventListener('submit', function(event) {
      event.preventDefault();
      var titulo = document.getElementById('titulo').value;
      var texto = document.getElementById('texto').value;
      var url = document.getElementById('url').value;
      var arquivoUrl = document.getElementById('arquivoUrl').value;
      google.script.run.withSuccessHandler(function() {
        $('#addModal').modal('hide');
        fetchCodigos(); // Atualizar a tabela em tempo real
      }).addCodigoToSheet(titulo, texto, url, arquivoUrl);
    });
  </script>

  <script>
    var li_items = document.querySelectorAll(".side_bar_bottom ul li");
    var side_bar_menu = document.querySelector(".side_bar_menu");
    var wrapper = document.querySelector(".wrapper");
    var main_containers = document.querySelectorAll(".main_container");
    li_items.forEach(function(li_main) {
      li_main.addEventListener("click", function() {
        li_items.forEach(function(li) {
          li.classList.remove("active");
        });
        li_main.classList.add("active");
        var target = li_main.getAttribute("data-target");
        main_containers.forEach(function(container) {
          if (container.id === target) {
            container.classList.add("active");
          } else {
            container.classList.remove("active");
          }
        });
      });
    });
    side_bar_menu.addEventListener("click", function() {
      wrapper.classList.toggle("active");
    });
  </script>

  <script>
    google.script.run.withSuccessHandler(displayFAQ).getFAQDataFromSheet();

    function displayFAQ(FAQData) {
      const FAQContainer = document.querySelector(".faq-container");
      FAQData.forEach(function(q, index) {
        const answerHTML = q.answer
          .map(function(a) {
            return `<div class="answer">
              <span class="answer-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd"/>
                </svg>
              </span>
              ${a}
            </div>`;
          })
          .join("");
        const html = `<div class="question-container">
            <div class="question">
                ${q.question}
                <span class="question-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/></svg></span>
            </div>
            <div class="answer-container">
                ${answerHTML}
            </div>
          </div>`;
        const questionContainer = document.createElement("div");
        questionContainer.classList.add("question-container");
        questionContainer.innerHTML = html;
        FAQContainer.appendChild(questionContainer);
        const question = questionContainer.querySelector(".question");
        question.addEventListener("click", function() {
          const isExpanded = !questionContainer.classList.contains("expanded");
          removeAllExpanded();
          questionContainer.classList.toggle("expanded", isExpanded);
          const answerContainer = questionContainer.querySelector(".answer-container");
          answerContainer.style.maxHeight = isExpanded ? `${answerContainer.scrollHeight}px` : "0";
        });
      });
    }

    function removeAllExpanded() {
      const questionContainers = document.querySelectorAll(".faq-container .question-container");
      questionContainers.forEach(function(q) {
        q.classList.remove("expanded");
        const answerContainer = q.querySelector(".answer-container");
        answerContainer.style.maxHeight = "0";
      });
    }
  </script>



  <script>
    $(document).ready(function(){
      $('#newsTicker1').breakingNews();
    });

    <?!= include('html/scripts') ?>
  </script>
</body>
</html>